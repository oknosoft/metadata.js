window.dhtmlXScheduler=window.scheduler={version:"4.3.0"};window.dhtmlx||(dhtmlx=function(a){for(var b in a)dhtmlx[b]=a[b];return dhtmlx});
dhtmlx.extend_api=function(a,b,c){var d=window[a];d&&(window[a]=function(a){var c;if(a&&"object"==typeof a&&!a.tagName){c=d.apply(this,b._init?b._init(a):arguments);for(var g in dhtmlx)if(b[g])this[b[g]](dhtmlx[g]);for(g in a)if(b[g])this[b[g]](a[g]);else 0===g.indexOf("on")&&this.attachEvent(g,a[g])}else c=d.apply(this,arguments);b._patch&&b._patch(this);return c||this},window[a].prototype=d.prototype,c&&dhtmlXHeir(window[a].prototype,c))};
dhtmlxAjax={get:function(a,b){var c=new dtmlXMLLoaderObject(!0);c.async=3>arguments.length;c.waitCall=b;c.loadXML(a);return c},post:function(a,b,c){var d=new dtmlXMLLoaderObject(!0);d.async=4>arguments.length;d.waitCall=c;d.loadXML(a,!0,b);return d},getSync:function(a){return this.get(a,null,!0)},postSync:function(a,b){return this.post(a,b,null,!0)}};
function dtmlXMLLoaderObject(a,b,c,d){this.xmlDoc="";this.async="undefined"!=typeof c?c:!0;this.onloadAction=a||null;this.mainObject=b||null;this.waitCall=null;this.rSeed=d||!1;return this}dtmlXMLLoaderObject.count=0;
dtmlXMLLoaderObject.prototype.waitLoadFunction=function(a){var b=!0;return this.check=function(){if(a&&a.onloadAction&&(!a.xmlDoc.readyState||4==a.xmlDoc.readyState)&&b){b=!1;dtmlXMLLoaderObject.count++;if("function"==typeof a.onloadAction)a.onloadAction(a.mainObject,null,null,null,a);a.waitCall&&(a.waitCall.call(this,a),a.waitCall=null)}}};
dtmlXMLLoaderObject.prototype.getXMLTopNode=function(a,b){var c;this.xmlDoc.responseXML?(c=this.xmlDoc.responseXML.getElementsByTagName(a),0===c.length&&-1!=a.indexOf(":")&&(c=this.xmlDoc.responseXML.getElementsByTagName(a.split(":")[1])),c=c[0]):c=this.xmlDoc.documentElement;if(c)return this._retry=!1,c;if(!this._retry&&_isIE)return this._retry=!0,b=this.xmlDoc,this.loadXMLString(this.xmlDoc.responseText.replace(/^[\s]+/,""),!0),this.getXMLTopNode(a,b);dhtmlxError.throwError("LoadXML","Incorrect XML",
[b||this.xmlDoc,this.mainObject]);return document.createElement("DIV")};dtmlXMLLoaderObject.prototype.loadXMLString=function(a,b){_isIE?(this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async=this.async,this.xmlDoc.onreadystatechange=function(){},this.xmlDoc.loadXML(a)):this.xmlDoc=(new DOMParser).parseFromString(a,"text/xml");if(!b){if(this.onloadAction)this.onloadAction(this.mainObject,null,null,null,this);this.waitCall&&(this.waitCall(),this.waitCall=null)}};
dtmlXMLLoaderObject.prototype.loadXML=function(a,b,c,d){this.rSeed&&(a+=(-1!=a.indexOf("?")?"&":"?")+"a_dhx_rSeed="+(new Date).valueOf());this.filePath=a;this.xmlDoc=!_isIE&&window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.async&&(this.xmlDoc.onreadystatechange=new this.waitLoadFunction(this));"string"==typeof b?this.xmlDoc.open(b,a,this.async):this.xmlDoc.open(b?"POST":"GET",a,this.async);d?(this.xmlDoc.setRequestHeader("User-Agent","dhtmlxRPC v0.1 ("+navigator.userAgent+
")"),this.xmlDoc.setRequestHeader("Content-type","text/xml")):b&&this.xmlDoc.setRequestHeader("Content-type","application/x-www-form-urlencoded");this.xmlDoc.setRequestHeader("X-Requested-With","XMLHttpRequest");this.xmlDoc.send(c);this.async||(new this.waitLoadFunction(this))()};
dtmlXMLLoaderObject.prototype.destructor=function(){return this.setXSLParamValue=this.getXMLTopNode=this.xmlNodeToJSON=this.doSerialization=this.loadXMLString=this.loadXML=this.doXSLTransToString=this.doXSLTransToObject=this.doXPathOpera=this.doXPath=this.xmlDoc=this.mainObject=this.onloadAction=this.filePath=this.rSeed=this.async=this._retry=this._getAllNamedChilds=this._filterXPath=null};
dtmlXMLLoaderObject.prototype.xmlNodeToJSON=function(a){for(var b={},c=0;c<a.attributes.length;c++)b[a.attributes[c].name]=a.attributes[c].value;b._tagvalue=a.firstChild?a.firstChild.nodeValue:"";for(c=0;c<a.childNodes.length;c++){var d=a.childNodes[c].tagName;d&&(b[d]||(b[d]=[]),b[d].push(this.xmlNodeToJSON(a.childNodes[c])))}return b};function callerFunction(a,b){return this.handler=function(c){c||(c=window.event);a(c,b);return!0}}function getAbsoluteLeft(a){return getOffset(a).left}
function getAbsoluteTop(a){return getOffset(a).top}function getOffsetSum(a){for(var b=0,c=0;a;)b+=parseInt(a.offsetTop),c+=parseInt(a.offsetLeft),a=a.offsetParent;return{top:b,left:c}}
function getOffsetRect(a){a=a.getBoundingClientRect();var b=document.body,c=document.documentElement,d=a.left+(window.pageXOffset||c.scrollLeft||b.scrollLeft)-(c.clientLeft||b.clientLeft||0);return{top:Math.round(a.top+(window.pageYOffset||c.scrollTop||b.scrollTop)-(c.clientTop||b.clientTop||0)),left:Math.round(d)}}function getOffset(a){return a.getBoundingClientRect?getOffsetRect(a):getOffsetSum(a)}
function convertStringToBoolean(a){"string"==typeof a&&(a=a.toLowerCase());switch(a){case "1":case "true":case "yes":case "y":case 1:case !0:return!0;default:return!1}}function getUrlSymbol(a){return-1!=a.indexOf("?")?"&":"?"}function dhtmlDragAndDropObject(){if(window.dhtmlDragAndDrop)return window.dhtmlDragAndDrop;this.dragStartObject=this.dragStartNode=this.dragNode=this.lastLanding=0;this.tempDOMM=this.tempDOMU=null;this.waitDrag=0;window.dhtmlDragAndDrop=this;return this}
dhtmlDragAndDropObject.prototype.removeDraggableItem=function(a){a.onmousedown=null;a.dragStarter=null;a.dragLanding=null};dhtmlDragAndDropObject.prototype.addDraggableItem=function(a,b){a.onmousedown=this.preCreateDragCopy;a.dragStarter=b;this.addDragLanding(a,b)};dhtmlDragAndDropObject.prototype.addDragLanding=function(a,b){a.dragLanding=b};
dhtmlDragAndDropObject.prototype.preCreateDragCopy=function(a){if(!a&&!window.event||2!=(a||event).button){if(window.dhtmlDragAndDrop.waitDrag)return window.dhtmlDragAndDrop.waitDrag=0,document.body.onmouseup=window.dhtmlDragAndDrop.tempDOMU,document.body.onmousemove=window.dhtmlDragAndDrop.tempDOMM,!1;window.dhtmlDragAndDrop.dragNode&&window.dhtmlDragAndDrop.stopDrag(a);window.dhtmlDragAndDrop.waitDrag=1;window.dhtmlDragAndDrop.tempDOMU=document.body.onmouseup;window.dhtmlDragAndDrop.tempDOMM=document.body.onmousemove;
window.dhtmlDragAndDrop.dragStartNode=this;window.dhtmlDragAndDrop.dragStartObject=this.dragStarter;document.body.onmouseup=window.dhtmlDragAndDrop.preCreateDragCopy;document.body.onmousemove=window.dhtmlDragAndDrop.callDrag;window.dhtmlDragAndDrop.downtime=(new Date).valueOf();a&&a.preventDefault&&a.preventDefault();return!1}};
dhtmlDragAndDropObject.prototype.callDrag=function(a){a||(a=window.event);var b=window.dhtmlDragAndDrop;if(!(100>(new Date).valueOf()-b.downtime)){if(!b.dragNode)if(b.waitDrag){b.dragNode=b.dragStartObject._createDragNode(b.dragStartNode,a);if(!b.dragNode)return b.stopDrag();b.dragNode.onselectstart=function(){return!1};b.gldragNode=b.dragNode;document.body.appendChild(b.dragNode);document.body.onmouseup=b.stopDrag;b.waitDrag=0;b.dragNode.pWindow=window;b.initFrameRoute()}else return b.stopDrag(a,
!0);if(b.dragNode.parentNode!=window.document.body&&b.gldragNode){var c=b.gldragNode;b.gldragNode.old&&(c=b.gldragNode.old);c.parentNode.removeChild(c);var d=b.dragNode.pWindow;c.pWindow&&c.pWindow.dhtmlDragAndDrop.lastLanding&&c.pWindow.dhtmlDragAndDrop.lastLanding.dragLanding._dragOut(c.pWindow.dhtmlDragAndDrop.lastLanding);_isIE?(c=document.createElement("Div"),c.innerHTML=b.dragNode.outerHTML,b.dragNode=c.childNodes[0]):b.dragNode=b.dragNode.cloneNode(!0);b.dragNode.pWindow=window;b.gldragNode.old=
b.dragNode;document.body.appendChild(b.dragNode);d.dhtmlDragAndDrop.dragNode=b.dragNode}b.dragNode.style.left=a.clientX+15+(b.fx?-1*b.fx:0)+(document.body.scrollLeft||document.documentElement.scrollLeft)+"px";b.dragNode.style.top=a.clientY+3+(b.fy?-1*b.fy:0)+(document.body.scrollTop||document.documentElement.scrollTop)+"px";b.checkLanding(a.srcElement?a.srcElement:a.target,a)}};
dhtmlDragAndDropObject.prototype.calculateFramePosition=function(a){if(window.name){for(var b=parent.frames[window.name].frameElement.offsetParent,c=0,d=0;b;)c+=b.offsetLeft,d+=b.offsetTop,b=b.offsetParent;parent.dhtmlDragAndDrop&&(b=parent.dhtmlDragAndDrop.calculateFramePosition(1),c+=1*b.split("_")[0],d+=1*b.split("_")[1]);if(a)return c+"_"+d;this.fx=c;this.fy=d}return"0_0"};
dhtmlDragAndDropObject.prototype.checkLanding=function(a,b){a&&a.dragLanding?(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding),this.lastLanding=a,this.lastLanding=this.lastLanding.dragLanding._dragIn(this.lastLanding,this.dragStartNode,b.clientX,b.clientY,b),this.lastLanding_scr=_isIE?b.srcElement:b.target):a&&"BODY"!=a.tagName?this.checkLanding(a.parentNode,b):(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding,b.clientX,b.clientY,b),this.lastLanding=
0,this._onNotFound&&this._onNotFound())};
dhtmlDragAndDropObject.prototype.stopDrag=function(a,b){var c=window.dhtmlDragAndDrop;if(!b){c.stopFrameRoute();var d=c.lastLanding;c.lastLanding=null;d&&d.dragLanding._drag(c.dragStartNode,c.dragStartObject,d,_isIE?event.srcElement:a.target)}c.lastLanding=null;c.dragNode&&c.dragNode.parentNode==document.body&&c.dragNode.parentNode.removeChild(c.dragNode);c.dragNode=0;c.gldragNode=0;c.fx=0;c.fy=0;c.dragStartNode=0;c.dragStartObject=0;document.body.onmouseup=c.tempDOMU;document.body.onmousemove=c.tempDOMM;
c.tempDOMU=null;c.tempDOMM=null;c.waitDrag=0};dhtmlDragAndDropObject.prototype.stopFrameRoute=function(a){a&&window.dhtmlDragAndDrop.stopDrag(1,1);for(var b=0;b<window.frames.length;b++)try{window.frames[b]!=a&&window.frames[b].dhtmlDragAndDrop&&window.frames[b].dhtmlDragAndDrop.stopFrameRoute(window)}catch(c){}try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=a&&parent.dhtmlDragAndDrop.stopFrameRoute(window)}catch(d){}};
dhtmlDragAndDropObject.prototype.initFrameRoute=function(a,b){a&&(window.dhtmlDragAndDrop.preCreateDragCopy(),window.dhtmlDragAndDrop.dragStartNode=a.dhtmlDragAndDrop.dragStartNode,window.dhtmlDragAndDrop.dragStartObject=a.dhtmlDragAndDrop.dragStartObject,window.dhtmlDragAndDrop.dragNode=a.dhtmlDragAndDrop.dragNode,window.dhtmlDragAndDrop.gldragNode=a.dhtmlDragAndDrop.dragNode,window.document.body.onmouseup=window.dhtmlDragAndDrop.stopDrag,window.waitDrag=0,!_isIE&&b&&(!_isFF||1.8>_FFrv)&&window.dhtmlDragAndDrop.calculateFramePosition());
try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=a&&parent.dhtmlDragAndDrop.initFrameRoute(window)}catch(c){}for(var d=0;d<window.frames.length;d++)try{window.frames[d]!=a&&window.frames[d].dhtmlDragAndDrop&&window.frames[d].dhtmlDragAndDrop.initFrameRoute(window,!a||b?1:0)}catch(e){}};_OperaRv=_KHTMLrv=_FFrv=_isChrome=_isMacOS=_isKHTML=_isOpera=_isIE=_isFF=!1;-1!=navigator.userAgent.indexOf("Macintosh")&&(_isMacOS=!0);-1<navigator.userAgent.toLowerCase().indexOf("chrome")&&(_isChrome=!0);
-1!=navigator.userAgent.indexOf("Safari")||-1!=navigator.userAgent.indexOf("Konqueror")?(_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5)),525<_KHTMLrv?(_isFF=!0,_FFrv=1.9):_isKHTML=!0):-1!=navigator.userAgent.indexOf("Opera")?(_isOpera=!0,_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3))):-1!=navigator.appName.indexOf("Microsoft")?(_isIE=!0,-1==navigator.appVersion.indexOf("MSIE 8.0")&&-1==navigator.appVersion.indexOf("MSIE 9.0")&&
-1==navigator.appVersion.indexOf("MSIE 10.0")||"BackCompat"==document.compatMode||(_isIE=8)):"Netscape"==navigator.appName&&-1!=navigator.userAgent.indexOf("Trident")?_isIE=8:(_isFF=!0,_FFrv=parseFloat(navigator.userAgent.split("rv:")[1]));
dtmlXMLLoaderObject.prototype.doXPath=function(a,b,c,d){if(_isKHTML||!_isIE&&!window.XPathResult)return this.doXPathOpera(a,b);if(_isIE)return b||(b=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),b||dhtmlxError.throwError("LoadXML","Incorrect XML",[b||this.xmlDoc,this.mainObject]),c&&b.setProperty("SelectionNamespaces","xmlns:xsl='"+c+"'"),"single"==d?b.selectSingleNode(a):b.selectNodes(a)||[];var e=b;b||(b=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML);b||dhtmlxError.throwError("LoadXML",
"Incorrect XML",[b||this.xmlDoc,this.mainObject]);-1!=b.nodeName.indexOf("document")?e=b:(e=b,b=b.ownerDocument);var f=XPathResult.ANY_TYPE;"single"==d&&(f=XPathResult.FIRST_ORDERED_NODE_TYPE);d=[];a=b.evaluate(a,e,function(a){return c},f,null);if(f==XPathResult.FIRST_ORDERED_NODE_TYPE)return a.singleNodeValue;for(f=a.iterateNext();f;)d[d.length]=f,f=a.iterateNext();return d};function _dhtmlxError(a,b,c){this.catches||(this.catches=[]);return this}
_dhtmlxError.prototype.catchError=function(a,b){this.catches[a]=b};_dhtmlxError.prototype.throwError=function(a,b,c){if(this.catches[a])return this.catches[a](a,b,c);if(this.catches.ALL)return this.catches.ALL(a,b,c);window.alert("Error type: "+a+"\nDescription: "+b);return null};window.dhtmlxError=new _dhtmlxError;
dtmlXMLLoaderObject.prototype.doXPathOpera=function(a,b){var c=a.replace(/[\/]+/gi,"/").split("/"),d=null,e=1;if(!c.length)return[];if("."==c[0])d=[b];else if(""===c[0])d=(this.xmlDoc.responseXML||this.xmlDoc).getElementsByTagName(c[e].replace(/\[[^\]]*\]/g,"")),e++;else return[];for(e;e<c.length;e++)d=this._getAllNamedChilds(d,c[e]);-1!=c[e-1].indexOf("[")&&(d=this._filterXPath(d,c[e-1]));return d};
dtmlXMLLoaderObject.prototype._filterXPath=function(a,b){var c=[];b=b.replace(/[^\[]*\[\@/g,"").replace(/[\[\]\@]*/g,"");for(var d=0;d<a.length;d++)a[d].getAttribute(b)&&(c[c.length]=a[d]);return c};
dtmlXMLLoaderObject.prototype._getAllNamedChilds=function(a,b){var c=[];_isKHTML&&(b=b.toUpperCase());for(var d=0;d<a.length;d++)for(var e=0;e<a[d].childNodes.length;e++)_isKHTML?a[d].childNodes[e].tagName&&a[d].childNodes[e].tagName.toUpperCase()==b&&(c[c.length]=a[d].childNodes[e]):a[d].childNodes[e].tagName==b&&(c[c.length]=a[d].childNodes[e]);return c};function dhtmlXHeir(a,b){for(var c in b)"function"==typeof b[c]&&(a[c]=b[c]);return a}
"undefined"==typeof window.dhtmlxEvent&&(window.dhtmlxEvent=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)});dtmlXMLLoaderObject.prototype.xslDoc=null;dtmlXMLLoaderObject.prototype.setXSLParamValue=function(a,b,c){c||(c=this.xslDoc);c.responseXML&&(c=c.responseXML);if(a=this.doXPath("/xsl:stylesheet/xsl:variable[@name='"+a+"']",c,"http://www.w3.org/1999/XSL/Transform","single"))a.firstChild.nodeValue=b};
dtmlXMLLoaderObject.prototype.doXSLTransToObject=function(a,b){a||(a=this.xslDoc);a.responseXML&&(a=a.responseXML);b||(b=this.xmlDoc);b.responseXML&&(b=b.responseXML);var c;if(_isIE){c=new ActiveXObject("Msxml2.DOMDocument.3.0");try{b.transformNodeToObject(a,c)}catch(d){c=b.transformNode(a)}}else this.XSLProcessor||(this.XSLProcessor=new XSLTProcessor,this.XSLProcessor.importStylesheet(a)),c=this.XSLProcessor.transformToDocument(b);return c};
dtmlXMLLoaderObject.prototype.doXSLTransToString=function(a,b){var c=this.doXSLTransToObject(a,b);return"string"==typeof c?c:this.doSerialization(c)};dtmlXMLLoaderObject.prototype.doSerialization=function(a){a||(a=this.xmlDoc);a.responseXML&&(a=a.responseXML);return _isIE?a.xml:(new XMLSerializer).serializeToString(a)};
dhtmlxEventable=function(a){a.attachEvent=function(a,c,d){a="ev_"+a.toLowerCase();this[a]||(this[a]=new this.eventCatcher(d||this));return a+":"+this[a].addEvent(c)};a.callEvent=function(a,c){a="ev_"+a.toLowerCase();return this[a]?this[a].apply(this,c):!0};a.checkEvent=function(a){return!!this["ev_"+a.toLowerCase()]};a.eventCatcher=function(a){var c=[],d=function(){for(var d=!0,f=0;f<c.length;f++)if(c[f])var g=c[f].apply(a,arguments),d=d&&g;return d};d.addEvent=function(a){"function"!=typeof a&&(a=
eval(a));return a?c.push(a)-1:!1};d.removeEvent=function(a){c[a]=null};return d};a.detachEvent=function(a){a&&(a=a.split(":"),this[a[0]].removeEvent(a[1]))};a.detachAllEvents=function(){for(var a in this)0===a.indexOf("ev_")&&(this.detachEvent(a),this[a]=null)};a=null};window.dhtmlx||(window.dhtmlx={});
(function(){function a(a,b){var d=a.callback;c(!1);a.box.parentNode.removeChild(a.box);h=a.box=null;d&&d(b)}function b(b){if(h){b=b||event;var c=b.which||event.keyCode;dhtmlx.message.keyboard&&(13!=c&&32!=c||a(h,!0),27==c&&a(h,!1));b.preventDefault&&b.preventDefault();return!(b.cancelBubble=!0)}}function c(a){c.cover||(c.cover=document.createElement("DIV"),c.cover.onkeydown=b,c.cover.className="dhx_modal_cover",document.body.appendChild(c.cover));c.cover.style.display=a?"inline-block":"none"}function d(a,
b,c){return"<div class='dhtmlx_popup_button "+("dhtmlx_"+(c?c:a||"").toLowerCase().replace(/ /g,"_")+"_button")+"' result='"+b+"' ><div>"+a+"</div></div>"}function e(a){m.area||(m.area=document.createElement("DIV"),m.area.className="dhtmlx_message_area",m.area.style[m.position]="5px",document.body.appendChild(m.area));m.hide(a.id);var b=document.createElement("DIV");b.innerHTML="<div>"+a.text+"</div>";b.className="dhtmlx-info dhtmlx-"+a.type;b.onclick=function(){m.hide(a.id);a=null};"bottom"==m.position&&
m.area.firstChild?m.area.insertBefore(b,m.area.firstChild):m.area.appendChild(b);0<a.expire&&(m.timers[a.id]=window.setTimeout(function(){m.hide(a.id)},a.expire));m.pull[a.id]=b;b=null;return a.id}function f(b,c,e){var f=document.createElement("DIV");f.className=" dhtmlx_modal_box dhtmlx-"+b.type;f.setAttribute("dhxbox",1);var u="";b.width&&(f.style.width=b.width);b.height&&(f.style.height=b.height);b.title&&(u+='<div class="dhtmlx_popup_title">'+b.title+"</div>");u+='<div class="dhtmlx_popup_text"><span>'+
(b.content?"":b.text)+'</span></div><div  class="dhtmlx_popup_controls">';if(c){var g=b.ok||scheduler.locale.labels.message_ok;void 0===g&&(g="OK");u+=d(g,!0,"ok")}e&&(g=b.cancel||scheduler.locale.labels.message_cancel,void 0===g&&(g="Cancel"),u+=d(g,!1,"cancel"));if(b.buttons)for(g=0;g<b.buttons.length;g++)u+=d(b.buttons[g],g);f.innerHTML=u+"</div>";b.content&&(u=b.content,"string"==typeof u&&(u=document.getElementById(u)),"none"==u.style.display&&(u.style.display=""),f.childNodes[b.title?1:0].appendChild(u));
f.onclick=function(c){c=c||event;c=c.target||c.srcElement;c.className||(c=c.parentNode);"dhtmlx_popup_button"==c.className.split(" ")[0]&&(c=c.getAttribute("result"),a(b,"true"==c||("false"==c?!1:c)))};b.box=f;if(c||e)h=b;return f}function g(a,d,e){d=a.tagName?a:f(a,d,e);a.hidden||c(!0);document.body.appendChild(d);e=Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-d.offsetWidth)/2));var g=Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-
d.offsetHeight)/2));d.style.top="top"==a.position?"-3px":g+"px";d.style.left=e+"px";d.onkeydown=b;d.focus();a.hidden&&dhtmlx.modalbox.hide(d);return d}function k(a,b,c){"object"!=typeof a&&("function"==typeof b&&(c=b,b=""),a={text:a,type:b,callback:c});return a}function l(a,b,c,d){"object"!=typeof a&&(a={text:a,type:b,expire:c,id:d});a.id=a.id||m.uid();a.expire=a.expire||m.expire;return a}var h=null;document.attachEvent?document.attachEvent("onkeydown",b):document.addEventListener("keydown",b,!0);
dhtmlx.alert=function(){var a=k.apply(this,arguments);a.type=a.type||"confirm";return g(a,!0,!1)};dhtmlx.confirm=function(){var a=k.apply(this,arguments);a.type=a.type||"alert";return g(a,!0,!0)};dhtmlx.modalbox=function(){var a=k.apply(this,arguments);a.type=a.type||"alert";return g(a)};dhtmlx.modalbox.hide=function(a){for(;a&&a.getAttribute&&!a.getAttribute("dhxbox");)a=a.parentNode;a&&(a.parentNode.removeChild(a),c(!1))};var m=dhtmlx.message=function(a,b,c,d){a=l.apply(this,arguments);a.type=a.type||
"info";switch(a.type.split("-")[0]){case "alert":return g(a,!0,!1);case "confirm":return g(a,!0,!0);case "modalbox":return g(a);default:return e(a)}};m.seed=(new Date).valueOf();m.uid=function(){return m.seed++};m.expire=4E3;m.keyboard=!0;m.position="top";m.pull={};m.timers={};m.hideAll=function(){for(var a in m.pull)m.hide(a)};m.hide=function(a){var b=m.pull[a];b&&b.parentNode&&(window.setTimeout(function(){b.parentNode.removeChild(b);b=null},2E3),b.className+=" hidden",m.timers[a]&&window.clearTimeout(m.timers[a]),
delete m.pull[a])}})();
function dataProcessor(a){this.serverProcessor=a;this.action_param="!nativeeditor_status";this.object=null;this.updatedRows=[];this.autoUpdate=!0;this.updateMode="cell";this._tMode="GET";this.post_delim="_";this._waitMode=0;this._in_progress={};this._invalid={};this.mandatoryFields=[];this.messages=[];this.styles={updated:"font-weight:bold;",inserted:"font-weight:bold;",deleted:"text-decoration : line-through;",invalid:"background-color:FFE0E0;",invalid_cell:"border-bottom:2px solid red;",error:"color:red;",
clear:"font-weight:normal;text-decoration:none;"};this.enableUTFencoding(!0);dhtmlxEventable(this);return this}
dataProcessor.prototype={setTransactionMode:function(a,b){this._tMode=a;this._tSend=b;"REST"==a&&(this._tSend=!1,this._endnm=!0)},escape:function(a){return this._utf?encodeURIComponent(a):escape(a)},enableUTFencoding:function(a){this._utf=convertStringToBoolean(a)},setDataColumns:function(a){this._columns="string"==typeof a?a.split(","):a},getSyncState:function(){return!this.updatedRows.length},enableDataNames:function(a){this._endnm=convertStringToBoolean(a)},enablePartialDataSend:function(a){this._changed=
convertStringToBoolean(a)},setUpdateMode:function(a,b){this.autoUpdate="cell"==a;this.updateMode=a;this.dnd=b},ignore:function(a,b){this._silent_mode=!0;a.call(b||window);this._silent_mode=!1},setUpdated:function(a,b,c){if(!this._silent_mode){var d=this.findRow(a);c=c||"updated";var e=this.obj.getUserData(a,this.action_param);e&&"updated"==c&&(c=e);b?(this.set_invalid(a,!1),this.updatedRows[d]=a,this.obj.setUserData(a,this.action_param,c),this._in_progress[a]&&(this._in_progress[a]="wait")):this.is_invalid(a)||
(this.updatedRows.splice(d,1),this.obj.setUserData(a,this.action_param,""));b||this._clearUpdateFlag(a);this.markRow(a,b,c);b&&this.autoUpdate&&this.sendData(a)}},_clearUpdateFlag:function(a){},markRow:function(a,b,c){var d="",e=this.is_invalid(a);e&&(d=this.styles[e],b=!0);if(this.callEvent("onRowMark",[a,b,c,e])&&(d=this.styles[b?c:"clear"]+d,this.obj[this._methods[0]](a,d),e&&e.details))for(d+=this.styles[e+"_cell"],b=0;b<e.details.length;b++)if(e.details[b])this.obj[this._methods[1]](a,b,d)},
getState:function(a){return this.obj.getUserData(a,this.action_param)},is_invalid:function(a){return this._invalid[a]},set_invalid:function(a,b,c){c&&(b={value:b,details:c,toString:function(){return this.value.toString()}});this._invalid[a]=b},checkBeforeUpdate:function(a){return!0},sendData:function(a){if(!this._waitMode||"tree"!=this.obj.mytype&&!this.obj._h2){this.obj.editStop&&this.obj.editStop();if("undefined"==typeof a||this._tSend)return this.sendAllData();if(this._in_progress[a])return!1;
this.messages=[];if(!this.checkBeforeUpdate(a)&&this.callEvent("onValidationError",[a,this.messages]))return!1;this._beforeSendData(this._getRowData(a),a)}},_beforeSendData:function(a,b){if(!this.callEvent("onBeforeUpdate",[b,this.getState(b),a]))return!1;this._sendData(a,b)},serialize:function(a,b){if("string"==typeof a)return a;if("undefined"!=typeof b)return this.serialize_one(a,"");var c=[],d=[],e;for(e in a)a.hasOwnProperty(e)&&(c.push(this.serialize_one(a[e],e+this.post_delim)),d.push(e));c.push("ids="+
this.escape(d.join(",")));dhtmlx.security_key&&c.push("dhx_security="+dhtmlx.security_key);return c.join("&")},serialize_one:function(a,b){if("string"==typeof a)return a;var c=[],d;for(d in a)a.hasOwnProperty(d)&&("id"!=d&&d!=this.action_param||"REST"!=this._tMode)&&c.push(this.escape((b||"")+d)+"="+this.escape(a[d]));return c.join("&")},_sendData:function(a,b){if(a){if(!this.callEvent("onBeforeDataSending",b?[b,this.getState(b),a]:[null,null,a]))return!1;b&&(this._in_progress[b]=(new Date).valueOf());
var c=new dtmlXMLLoaderObject(function(c,d,e,l,h){d=[];if(b)d.push(b);else if(a)for(var m in a)d.push(m);return c.afterUpdate(c,h,d)},this,!0),d=this.serverProcessor+(this._user?getUrlSymbol(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+this.obj.getUserData(0,"version")].join("&"):"");if("GET"==this._tMode)c.loadXML(d+(-1!=d.indexOf("?")?"&":"?")+this.serialize(a,b));else if("POST"==this._tMode)c.loadXML(d,!0,this.serialize(a,b));else if("REST"==this._tMode){var e=this.getState(b),
d=d.replace(/(\&|\?)editing\=true/,"");"inserted"==e?c.loadXML(d+b,"POST",this.serialize(a,b)):"deleted"==e?c.loadXML(d+b,"DELETE",""):c.loadXML(d+b,"PUT",this.serialize(a,b))}this._waitMode++}},sendAllData:function(){if(this.updatedRows.length){this.messages=[];for(var a=!0,b=0;b<this.updatedRows.length;b++)a&=this.checkBeforeUpdate(this.updatedRows[b]);if(!a&&!this.callEvent("onValidationError",["",this.messages]))return!1;if(this._tSend)this._sendData(this._getAllData());else for(b=0;b<this.updatedRows.length&&
(this._in_progress[this.updatedRows[b]]||this.is_invalid(this.updatedRows[b])||(this._beforeSendData(this._getRowData(this.updatedRows[b]),this.updatedRows[b]),!this._waitMode||"tree"!=this.obj.mytype&&!this.obj._h2));b++);}},_getAllData:function(a){a={};for(var b=!1,c=0;c<this.updatedRows.length;c++){var d=this.updatedRows[c];this._in_progress[d]||this.is_invalid(d)||!this.callEvent("onBeforeUpdate",[d,this.getState(d),this._getRowData(d)])||(a[d]=this._getRowData(d,d+this.post_delim),b=!0,this._in_progress[d]=
(new Date).valueOf())}return b?a:null},setVerificator:function(a,b){this.mandatoryFields[a]=b||function(a){return""!==a}},clearVerificator:function(a){this.mandatoryFields[a]=!1},findRow:function(a){for(var b=0,b=0;b<this.updatedRows.length&&a!=this.updatedRows[b];b++);return b},defineAction:function(a,b){this._uActions||(this._uActions=[]);this._uActions[a]=b},afterUpdateCallback:function(a,b,c,d){var e=a,f="error"!=c&&"invalid"!=c;f||this.set_invalid(a,c);if(this._uActions&&this._uActions[c]&&!this._uActions[c](d))return delete this._in_progress[e];
"wait"!=this._in_progress[e]&&this.setUpdated(a,!1);var g=a;switch(c){case "inserted":case "insert":b!=a&&(this.obj[this._methods[2]](a,b),a=b);break;case "delete":case "deleted":return this.obj.setUserData(a,this.action_param,"true_deleted"),this.obj[this._methods[3]](a),delete this._in_progress[e],this.callEvent("onAfterUpdate",[a,c,b,d])}"wait"!=this._in_progress[e]?(f&&this.obj.setUserData(a,this.action_param,""),delete this._in_progress[e]):(delete this._in_progress[e],this.setUpdated(b,!0,this.obj.getUserData(a,
this.action_param)));this.callEvent("onAfterUpdate",[g,c,b,d])},afterUpdate:function(a,b,c){if(window.JSON)try{var d=JSON.parse(b.xmlDoc.responseText),e=d.action||this.getState(c)||"updated",f=d.sid||c[0],g=d.tid||c[0];a.afterUpdateCallback(f,g,e,d);a.finalizeUpdate();return}catch(k){}b.getXMLTopNode("data");if(!b.xmlDoc.responseXML)return this.obj&&this.obj.callEvent&&this.obj.callEvent("onSaveError",[c,b.xmlDoc]),this.cleanUpdate(c);b=b.doXPath("//data/action");if(!b.length)return this.cleanUpdate(c);
for(c=0;c<b.length;c++)d=b[c],e=d.getAttribute("type"),f=d.getAttribute("sid"),g=d.getAttribute("tid"),a.afterUpdateCallback(f,g,e,d);a.finalizeUpdate()},cleanUpdate:function(a){if(a)for(var b=0;b<a.length;b++)delete this._in_progress[a[b]]},finalizeUpdate:function(){this._waitMode&&this._waitMode--;("tree"==this.obj.mytype||this.obj._h2)&&this.updatedRows.length&&this.sendData();this.callEvent("onAfterUpdateFinish",[]);this.updatedRows.length||this.callEvent("onFullSync",[])},init:function(a){this.obj=
a;this.obj._dp_init&&this.obj._dp_init(this)},setOnAfterUpdate:function(a){this.attachEvent("onAfterUpdate",a)},enableDebug:function(a){},setOnBeforeUpdateHandler:function(a){this.attachEvent("onBeforeDataSending",a)},setAutoUpdate:function(a,b){a=a||2E3;this._user=b||(new Date).valueOf();this._need_update=!1;this._loader=null;this._update_busy=!1;this.attachEvent("onAfterUpdate",function(a,b,c,g){this.afterAutoUpdate(a,b,c,g)});this.attachEvent("onFullSync",function(){this.fullSync()});var c=this;
window.setInterval(function(){c.loadUpdate()},a)},afterAutoUpdate:function(a,b,c,d){return"collision"==b?(this._need_update=!0,!1):!0},fullSync:function(){this._need_update&&(this._need_update=!1,this.loadUpdate());return!0},getUpdates:function(a,b){if(this._update_busy)return!1;this._update_busy=!0;this._loader=this._loader||new dtmlXMLLoaderObject(!0);this._loader.async=!0;this._loader.waitCall=b;this._loader.loadXML(a)},_v:function(a){return a.firstChild?a.firstChild.nodeValue:""},_a:function(a){for(var b=
[],c=0;c<a.length;c++)b[c]=this._v(a[c]);return b},loadUpdate:function(){var a=this,b=this.obj.getUserData(0,"version"),b=this.serverProcessor+getUrlSymbol(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+b].join("&"),b=b.replace("editing=true&","");this.getUpdates(b,function(){var b=a._loader.doXPath("//userdata");a.obj.setUserData(0,"version",a._v(b[0]));b=a._loader.doXPath("//update");if(b.length){a._silent_mode=!0;for(var d=0;d<b.length;d++){var e=b[d].getAttribute("status"),f=b[d].getAttribute("id"),
g=b[d].getAttribute("parent");switch(e){case "inserted":a.callEvent("insertCallback",[b[d],f,g]);break;case "updated":a.callEvent("updateCallback",[b[d],f,g]);break;case "deleted":a.callEvent("deleteCallback",[b[d],f,g])}}a._silent_mode=!1}a._update_busy=!1;a=null})}};
window.dataProcessor&&!dataProcessor.prototype.init_original&&(dataProcessor.prototype.init_original=dataProcessor.prototype.init,dataProcessor.prototype.init=function(a){this.init_original(a);a._dataprocessor=this;this.setTransactionMode("POST",!0);this.serverProcessor+=(-1!=this.serverProcessor.indexOf("?")?"&":"?")+"editing=true"});dhtmlxError.catchError("LoadXML",function(a,b,c){a=c[0].responseText;switch(scheduler.config.ajax_error){case "alert":window.alert(a);break;case "console":window.console.log(a)}});
dhtmlxEventable(scheduler);scheduler._detachDomEvent=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)};
scheduler._init_once=function(){function a(){return{w:window.innerWidth||document.documentElement.clientWidth,h:window.innerHeight||document.documentElement.clientHeight}}var b=a();dhtmlxEvent(window,"resize",function(){var c=a();if(b.w!=c.w||b.h!=c.h)window.clearTimeout(scheduler._resize_timer),scheduler._resize_timer=window.setTimeout(function(){scheduler.callEvent("onSchedulerResize",[])&&(scheduler.update_view(),scheduler.callEvent("onAfterSchedulerResize",[]))},100);b=c});scheduler._init_once=
function(){}};
scheduler.init=function(a,b,c){b=b||scheduler._currentDate();c=c||"week";this._obj&&this.unset_actions();this._obj="string"==typeof a?document.getElementById(a):a;this._skin_init&&scheduler._skin_init();scheduler.date.init();this._els=[];this._scroll=!0;this._quirks=_isIE&&"BackCompat"==document.compatMode;this._quirks7=_isIE&&-1==navigator.appVersion.indexOf("MSIE 8");this.get_elements();this.init_templates();this.set_actions();this._init_once();this._init_touch_events();this.set_sizes();scheduler.callEvent("onSchedulerReady",
[]);this.setCurrentView(b,c)};scheduler.xy={min_event_height:40,scale_width:50,scroll_width:18,scale_height:20,month_scale_height:20,menu_width:25,margin_top:0,margin_left:0,editor_width:140,month_head_height:22};scheduler.keys={edit_save:13,edit_cancel:27};
scheduler.set_sizes=function(){var a=this._x=this._obj.clientWidth-this.xy.margin_left,b=this._y=this._obj.clientHeight-this.xy.margin_top,c=this._table_view?0:this.xy.scale_width+this.xy.scroll_width,d=this._table_view?-1:this.xy.scale_width;this.set_xy(this._els.dhx_cal_navline[0],a,this.xy.nav_height,0,0);this.set_xy(this._els.dhx_cal_header[0],a-c,this.xy.scale_height,d,this.xy.nav_height+(this._quirks?-1:1));c=this._els.dhx_cal_navline[0].offsetHeight;0<c&&(this.xy.nav_height=c);c=this.xy.scale_height+
this.xy.nav_height+(this._quirks?-2:0);this.set_xy(this._els.dhx_cal_data[0],a,b-(c+2),0,c+2)};scheduler.set_xy=function(a,b,c,d,e){a.style.width=Math.max(0,b)+"px";a.style.height=Math.max(0,c)+"px";3<arguments.length&&(a.style.left=d+"px",a.style.top=e+"px")};
scheduler.get_elements=function(){for(var a=this._obj.getElementsByTagName("DIV"),b=0;b<a.length;b++){var c=a[b].className||"",d=a[b].getAttribute("name")||"";c&&(c=c.split(" ")[0]);this._els[c]||(this._els[c]=[]);this._els[c].push(a[b]);c=scheduler.locale.labels[d||c];"string"!==typeof c&&d&&!a[b].innerHTML&&(c=d.split("_")[0]);c&&(a[b].innerHTML=c)}};
scheduler.unset_actions=function(){for(var a in this._els)if(this._click[a])for(var b=0;b<this._els[a].length;b++)this._els[a][b].onclick=null;this._obj.onselectstart=null;this._obj.onmousemove=null;this._obj.onmousedown=null;this._obj.onmouseup=null;this._obj.ondblclick=null;this._obj.oncontextmenu=null};
scheduler.set_actions=function(){for(var a in this._els)if(this._click[a])for(var b=0;b<this._els[a].length;b++)this._els[a][b].onclick=scheduler._click[a];this._obj.onselectstart=function(a){return!1};this._obj.onmousemove=function(a){scheduler._temp_touch_block||scheduler._on_mouse_move(a||event)};this._obj.onmousedown=function(a){scheduler._ignore_next_click||scheduler._on_mouse_down(a||event)};this._obj.onmouseup=function(a){scheduler._ignore_next_click||scheduler._on_mouse_up(a||event)};this._obj.ondblclick=
function(a){scheduler._on_dbl_click(a||event)};this._obj.oncontextmenu=function(a){a=a||event;return scheduler.callEvent("onContextMenu",[scheduler._locate_event(a.target||a.srcElement),a])}};scheduler.select=function(a){this._select_id!=a&&(scheduler._close_not_saved(),this.editStop(!1),this.unselect(),this._select_id=a,this.updateEvent(a))};scheduler.unselect=function(a){a&&a!=this._select_id||(a=this._select_id,this._select_id=null,a&&this.getEvent(a)&&this.updateEvent(a))};
scheduler.getState=function(){return{mode:this._mode,date:new Date(this._date),min_date:new Date(this._min_date),max_date:new Date(this._max_date),editor_id:this._edit_id,lightbox_id:this._lightbox_id,new_event:this._new_event,select_id:this._select_id,expanded:this.expanded,drag_id:this._drag_id,drag_mode:this._drag_mode}};
scheduler._click={dhx_cal_data:function(a){if(scheduler._ignore_next_click)return a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,scheduler._ignore_next_click=!1;var b=a?a.target:event.srcElement,c=scheduler._locate_event(b);a=a||event;if(!c)scheduler.callEvent("onEmptyClick",[scheduler.getActionData(a).date,a]);else if(!scheduler.callEvent("onClick",[c,a])||scheduler.config.readonly)return;if(c&&scheduler.config.select){if(scheduler.select(c),a=b.className,-1!=a.indexOf("_icon"))scheduler._click.buttons[a.split(" ")[1].replace("icon_",
"")](c)}else scheduler._close_not_saved(),500<(new Date).valueOf()-(scheduler._new_event||0)&&scheduler.unselect()},dhx_cal_prev_button:function(){scheduler._click.dhx_cal_next_button(0,-1)},dhx_cal_next_button:function(a,b){scheduler.setCurrentView(scheduler.date.add(scheduler.date[scheduler._mode+"_start"](scheduler._date),b||1,scheduler._mode))},dhx_cal_today_button:function(){scheduler.callEvent("onBeforeTodayDisplayed",[])&&scheduler.setCurrentView(scheduler._currentDate())},dhx_cal_tab:function(){var a=
this.getAttribute("name"),a=a.substring(0,a.search("_tab"));scheduler.setCurrentView(scheduler._date,a)},buttons:{"delete":function(a){scheduler._dhtmlx_confirm(scheduler.locale.labels.confirm_deleting,scheduler.locale.labels.title_confirm_deleting,function(){scheduler.deleteEvent(a)})},edit:function(a){scheduler.edit(a)},save:function(a){scheduler.editStop(!0)},details:function(a){scheduler.showLightbox(a)},cancel:function(a){scheduler.editStop(!1)}}};
scheduler._dhtmlx_confirm=function(a,b,c){if(!a)return c();a={text:a};b&&(a.title=b);c&&(a.callback=function(a){a&&c()});dhtmlx.confirm(a)};
scheduler.addEventNow=function(a,b,c){var d={};a&&null!==a.constructor.toString().match(/object/i)&&(d=a,a=null);var e=6E4*(this.config.event_duration||this.config.time_step);a||(a=d.start_date||Math.round(scheduler._currentDate().valueOf()/e)*e);var f=new Date(a);b||(b=this.config.first_hour,b>f.getHours()&&(f.setHours(b),a=f.valueOf()),b=a.valueOf()+e);a=new Date(b);f.valueOf()==a.valueOf()&&a.setTime(a.valueOf()+e);d.start_date=d.start_date||f;d.end_date=d.end_date||a;d.text=d.text||this.locale.labels.new_event;
d.id=this._drag_id=this.uid();this._drag_mode="new-size";this._loading=!0;this.addEvent(d);this.callEvent("onEventCreated",[this._drag_id,c]);this._loading=!1;this._drag_event={};this._on_mouse_up(c)};
scheduler._on_dbl_click=function(a,b){b=b||a.target||a.srcElement;if(!this.config.readonly){var c=(b.className||"").split(" ")[0];switch(c){case "dhx_scale_holder":case "dhx_scale_holder_now":case "dhx_month_body":case "dhx_wa_day_data":if(!scheduler.config.dblclick_create)break;this.addEventNow(this.getActionData(a).date,null,a);break;case "dhx_cal_event":case "dhx_wa_ev_body":case "dhx_agenda_line":case "dhx_grid_event":case "dhx_cal_event_line":case "dhx_cal_event_clear":c=this._locate_event(b);
if(!this.callEvent("onDblClick",[c,a]))break;this.config.details_on_dblclick||this._table_view||!this.getEvent(c)._timed||!this.config.select?this.showLightbox(c):this.edit(c);break;case "dhx_time_block":case "dhx_cal_container":break;default:if(c=this["dblclick_"+c])c.call(this,a);else if(b.parentNode&&b!=this)return scheduler._on_dbl_click(a,b.parentNode)}}};
scheduler._get_column_index=function(a){var b=0;if(this._cols){for(var c=b=0;c<this._cols.length&&!b;c++)b=this._cols[c];b=b?a/b:0;if(this._ignores)for(c=0;c<=b;c++)this._ignores[c]&&b++}return b};scheduler._week_indexes_from_pos=function(a){if(this._cols){var b=this._get_column_index(a.x);a.x=Math.min(this._cols.length-1,Math.max(0,Math.ceil(b)-1));a.y=Math.max(0,Math.ceil(60*a.y/(this.config.time_step*this.config.hour_size_px))-1)+60/this.config.time_step*this.config.first_hour}return a};
scheduler._mouse_coords=function(a){var b;b=document.body;var c=document.documentElement;b=_isIE||!a.pageX&&!a.pageY?{x:a.clientX+(b.scrollLeft||c.scrollLeft||0)-b.clientLeft,y:a.clientY+(b.scrollTop||c.scrollTop||0)-b.clientTop}:{x:a.pageX,y:a.pageY};b.x-=getAbsoluteLeft(this._obj)+(this._table_view?0:this.xy.scale_width);b.y-=getAbsoluteTop(this._obj)+this.xy.nav_height+(this._dy_shift||0)+this.xy.scale_height-this._els.dhx_cal_data[0].scrollTop;b.ev=a;if(a=this["mouse_"+this._mode])return a.call(this,
b);if(this._table_view){a=this._get_column_index(b.x);if(!this._cols||!this._colsS)return b;c=0;for(c=1;c<this._colsS.heights.length&&!(this._colsS.heights[c]>b.y);c++);b.y=Math.ceil(1440*(Math.max(0,a)+7*Math.max(0,c-1))/this.config.time_step);if(scheduler._drag_mode||"month"==this._mode)b.y=1440*(Math.max(0,Math.ceil(a)-1)+7*Math.max(0,c-1))/this.config.time_step;"move"==this._drag_mode&&scheduler._ignores_detected&&scheduler.config.preserve_length&&(b._ignores=!0,this._drag_event._event_length||
(this._drag_event._event_length=this._get_real_event_length(this._drag_event.start_date,this._drag_event.end_date,{x_step:1,x_unit:"day"})));b.x=0}else b=this._week_indexes_from_pos(b);return b};scheduler._close_not_saved=function(){500<(new Date).valueOf()-(scheduler._new_event||0)&&scheduler._edit_id&&scheduler._dhtmlx_confirm(scheduler.locale.labels.confirm_closing,scheduler.locale.labels.title_confirm_closing,function(){scheduler.editStop(scheduler.config.positive_closing)})};
scheduler._correct_shift=function(a,b){return a-6E4*((new Date(scheduler._min_date)).getTimezoneOffset()-(new Date(a)).getTimezoneOffset())*(b?-1:1)};scheduler._is_pos_changed=function(a,b){var c;(c=!this._drag_pos.start||100<+new Date-this._drag_pos.start)||(c=!!(5<Math.abs(a.x-b.x)));c||(c=!!(5<Math.abs(a.y-b.y)));return!!c};
scheduler._on_mouse_move=function(a){if(this._drag_mode){var b=this._mouse_coords(a);if(b.force_redraw||this._is_pos_changed(this._drag_pos,b)){var c,d;this._edit_id!=this._drag_id&&this._close_not_saved();this._drag_pos=b;this._drag_pos.has_moved=!0;if("create"==this._drag_mode){this._close_not_saved();this.unselect(this._select_id);this._loading=!0;c=this._get_date_from_pos(b).valueOf();if(!this._drag_start){if(!this.callEvent("onBeforeEventCreated",[a,this._drag_id]))return;this._drag_start=c;
return}var e=new Date(this._drag_start);c=new Date(c);"day"!=this._mode&&"week"!=this._mode||e.getHours()!=c.getHours()||e.getMinutes()!=c.getMinutes()||(c=new Date(this._drag_start+1E3));this._drag_id=this.uid();this.addEvent(e,c,this.locale.labels.new_event,this._drag_id,b.fields);this.callEvent("onEventCreated",[this._drag_id,a]);this._loading=!1;this._drag_mode="new-size"}e=this.getEvent(this._drag_id);if("move"==this._drag_mode)c=this._min_date.valueOf()+6E4*(b.y*this.config.time_step+1440*b.x-
(scheduler._move_pos_shift||0)),!b.custom&&this._table_view&&(c+=1E3*this.date.time_part(e.start_date)),c=this._correct_shift(c),b._ignores&&this.config.preserve_length&&this._table_view?(this.matrix&&(d=this.matrix[this._mode]),d=d||{x_step:1,x_unit:"day"},d=1*c+this._get_fictional_event_length(c,this._drag_event._event_length,d)):d=e.end_date.valueOf()-(e.start_date.valueOf()-c);else{c=e.start_date.valueOf();d=e.end_date.valueOf();if(this._table_view){var f=this._min_date.valueOf()+b.y*this.config.time_step*
6E4+(b.custom?0:864E5);if("month"==this._mode)if(f=this._correct_shift(f,!1),this._drag_from_start){var g=864E5;f<=scheduler.date.date_part(new Date(d+g-1)).valueOf()&&(c=f-g)}else d=f;else b.resize_from_start?c=f:d=f}else if(d=this.date.date_part(new Date(e.end_date.valueOf()-1)).valueOf()+b.y*this.config.time_step*6E4,this._els.dhx_cal_data[0].style.cursor="s-resize","week"==this._mode||"day"==this._mode)d=this._correct_shift(d);"new-size"==this._drag_mode?d<=this._drag_start?(g=b.shift||(this._table_view&&
!b.custom?864E5:0),c=d-(b.shift?0:g),d=this._drag_start+(g||6E4*this.config.time_step)):c=this._drag_start:d<=c&&(d=c+6E4*this.config.time_step)}g=new Date(d-1);c=new Date(c);scheduler.config.limit_drag_out&&(+c<+scheduler._min_date||+d>+scheduler._max_date)&&(f=d-c,+c<+scheduler._min_date?(c=new Date(scheduler._min_date),d=new Date(+c+f)):(d=new Date(scheduler._max_date),c=new Date(+d-f)),g=new Date(d-1));this._table_view||scheduler.config.all_timed||!(!scheduler._get_section_view()&&b.x!=this._get_event_sday({start_date:new Date(d),
end_date:new Date(d)})||(new Date(d)).getHours()>=this.config.last_hour)||(f=d-c,g=this._min_date.valueOf()+864E5*b.x,d=scheduler.date.date_part(new Date(g)),d.setHours(this.config.last_hour),g=new Date(d-1),"move"==this._drag_mode&&(c=new Date(+d-f)));if(this._table_view||g.getDate()==c.getDate()&&g.getHours()<this.config.last_hour||scheduler._allow_dnd)e.start_date=c,e.end_date=new Date(d),this.config.update_render?(b=scheduler._els.dhx_cal_data[0].scrollTop,this.update_view(),scheduler._els.dhx_cal_data[0].scrollTop=
b):this.updateEvent(this._drag_id);this._table_view&&this.for_rendered(this._drag_id,function(a){a.className+=" dhx_in_move"});this.callEvent("onEventDrag",[this._drag_id,this._drag_mode,a])}}else scheduler.checkEvent("onMouseMove")&&(b=this._locate_event(a.target||a.srcElement),this.callEvent("onMouseMove",[b,a]))};
scheduler._on_mouse_down=function(a,b){if(2!=a.button&&!this.config.readonly&&!this._drag_mode){b=b||a.target||a.srcElement;var c=b.className&&b.className.split(" ")[0];switch(c){case "dhx_cal_event_line":case "dhx_cal_event_clear":this._table_view&&(this._drag_mode="move");break;case "dhx_event_move":case "dhx_wa_ev_body":this._drag_mode="move";break;case "dhx_event_resize":this._drag_mode="resize";0>(b.className||"").indexOf("dhx_event_resize_end")?scheduler._drag_from_start=!0:scheduler._drag_from_start=
!1;break;case "dhx_scale_holder":case "dhx_scale_holder_now":case "dhx_month_body":case "dhx_matrix_cell":case "dhx_marked_timespan":this._drag_mode="create";break;case "":if(b.parentNode)return scheduler._on_mouse_down(a,b.parentNode);break;default:if((!scheduler.checkEvent("onMouseDown")||scheduler.callEvent("onMouseDown",[c]))&&b.parentNode&&b!=this&&"dhx_body"!=c)return scheduler._on_mouse_down(a,b.parentNode);this._drag_id=this._drag_mode=null}this._drag_mode&&(c=this._locate_event(b),this.config["drag_"+
this._drag_mode]&&this.callEvent("onBeforeDrag",[c,this._drag_mode,a])?(this._drag_id=c,this._drag_event=scheduler._lame_clone(this.getEvent(this._drag_id)||{}),this._drag_pos=this._mouse_coords(a),this._drag_pos.start=+new Date):this._drag_mode=this._drag_id=0);this._drag_start=null}};scheduler._get_private_properties=function(a){var b={},c;for(c in a)0===c.indexOf("_")&&(b[c]=!0);return b};
scheduler._clear_temporary_properties=function(a,b){var c=this._get_private_properties(a),d=this._get_private_properties(b),e;for(e in d)c[e]||delete b[e]};
scheduler._on_mouse_up=function(a){if(!a||2!=a.button||!scheduler.config.touch){if(this._drag_mode&&this._drag_id){this._els.dhx_cal_data[0].style.cursor="default";var b=this._drag_id,c=this._drag_mode,d=this.getEvent(this._drag_id);if(this._drag_event._dhx_changed||!this._drag_event.start_date||d.start_date.valueOf()!=this._drag_event.start_date.valueOf()||d.end_date.valueOf()!=this._drag_event.end_date.valueOf()){var e="new-size"==this._drag_mode;if(this.callEvent("onBeforeEventChanged",[d,a,e,
this._drag_event]))if(this._drag_id=this._drag_mode=null,e&&this.config.edit_on_create){this.unselect();this._new_event=new Date;if(this._table_view||this.config.details_on_create||!this.config.select)return scheduler.callEvent("onDragEnd",[b,c,a]),this.showLightbox(b);this._drag_pos=!0;this._select_id=this._edit_id=b}else this._new_event||this.callEvent(e?"onEventAdded":"onEventChanged",[b,this.getEvent(b)]);else e?this.deleteEvent(d.id,!0):(this._drag_event._dhx_changed=!1,this._clear_temporary_properties(d,
this._drag_event),scheduler._lame_copy(d,this._drag_event),this.updateEvent(d.id))}this._drag_pos&&(this._drag_pos.has_moved||!0===this._drag_pos)&&this.render_view_data();scheduler.callEvent("onDragEnd",[b,c,a])}this._drag_pos=this._drag_mode=this._drag_id=null}};scheduler._trigger_dyn_loading=function(){return this._load_mode&&this._load()?this._render_wait=!0:!1};
scheduler.update_view=function(){var a=this[this._mode+"_view"];a?a(!0):this._reset_scale();if(this._trigger_dyn_loading())return!0;this.render_view_data()};scheduler.isViewExists=function(a){return!!(scheduler[a+"_view"]||scheduler.date[a+"_start"]&&scheduler.templates[a+"_date"]&&scheduler.templates[a+"_scale_date"])};
scheduler.updateView=function(a,b){a=a||this._date;b=b||this._mode;this._obj.className=this._mode?this._obj.className.replace("dhx_scheduler_"+this._mode,"dhx_scheduler_"+b):this._obj.className+(" dhx_scheduler_"+b);var c=this._mode==b&&this.config.preserve_scroll?this._els.dhx_cal_data[0].scrollTop:!1;if(this[this._mode+"_view"]&&b&&this._mode!=b)this[this._mode+"_view"](!1);this._close_not_saved();this._els.dhx_multi_day&&(this._els.dhx_multi_day[0].parentNode.removeChild(this._els.dhx_multi_day[0]),
this._els.dhx_multi_day=null);this._mode=b;this._date=a;this._table_view="month"==this._mode;this._dy_shift=0;var d=this._els.dhx_cal_tab;if(d)for(var e=0;e<d.length;e++){var f=d[e].className,f=f.replace(/ active/g,"");d[e].getAttribute("name")==this._mode+"_tab"&&(f+=" active");d[e].className=f}this.update_view();"number"==typeof c&&(this._els.dhx_cal_data[0].scrollTop=c)};
scheduler.setCurrentView=function(a,b){this.callEvent("onBeforeViewChange",[this._mode,this._date,b||this._mode,a||this._date])&&(this.updateView(a,b),this.callEvent("onViewChange",[this._mode,this._date]))};
scheduler._render_x_header=function(a,b,c,d,e){e=e||0;var f=document.createElement("DIV");f.className="dhx_scale_bar";this.templates[this._mode+"_scalex_class"]&&(f.className+=" "+this.templates[this._mode+"_scalex_class"](c));var g=this._cols[a]-1;"month"==this._mode&&0===a&&this.config.left_border&&(f.className+=" dhx_scale_bar_border",b+=1);this.set_xy(f,g,this.xy.scale_height-2,b,e);f.innerHTML=this.templates[this._mode+"_scale_date"](c,this._mode);d.appendChild(f)};
scheduler._get_columns_num=function(a,b){var c=7;scheduler._table_view||((c=scheduler.date["get_"+scheduler._mode+"_end"])&&(b=c(a)),c=Math.round((b.valueOf()-a.valueOf())/864E5));return c};scheduler._get_timeunit_start=function(){return this.date[this._mode+"_start"](new Date(this._date.valueOf()))};scheduler._get_view_end=function(){var a=this._get_timeunit_start(),b=scheduler.date.add(a,1,this._mode);if(!scheduler._table_view){var c=scheduler.date["get_"+scheduler._mode+"_end"];c&&(b=c(a))}return b};
scheduler._calc_scale_sizes=function(a,b,c){c=this._get_columns_num(b,c);this._process_ignores(b,c,"day",1);b=c-this._ignores_detected;for(var d=0;d<c;d++)this._ignores[d]?(this._cols[d]=0,b++):this._cols[d]=Math.floor(a/(b-d)),a-=this._cols[d],this._colsS[d]=(this._cols[d-1]||0)+(this._colsS[d-1]||(this._table_view?0:this.xy.scale_width+2));this._colsS.col_length=c;this._colsS[c]=this._cols[c-1]+this._colsS[c-1]||0};
scheduler._set_scale_col_size=function(a,b,c){var d=this.config;this.set_xy(a,b-1,d.hour_size_px*(d.last_hour-d.first_hour),c+this.xy.scale_width+1,0)};
scheduler._render_scales=function(a,b){var c=new Date(scheduler._min_date),d=new Date(scheduler._max_date),e=this.date.date_part(scheduler._currentDate()),f=parseInt(a.style.width,10),g=new Date(this._min_date),k=this._get_columns_num(c,d);this._calc_scale_sizes(f,c,d);c=0;a.innerHTML="";for(d=0;d<k;d++){this._ignores[d]||this._render_x_header(d,c,g,a);if(!this._table_view){var f=document.createElement("DIV"),l="dhx_scale_holder";g.valueOf()==e.valueOf()&&(l="dhx_scale_holder_now");this._ignores_detected&&
this._ignores[d]&&(l+=" dhx_scale_ignore");f.className=l+" "+this.templates.week_date_class(g,e);this._set_scale_col_size(f,this._cols[d],c);b.appendChild(f);this.callEvent("onScaleAdd",[f,g])}c+=this._cols[d];g=this.date.add(g,1,"day");g=this.date.day_start(g)}};
scheduler._reset_scale=function(){if(this.templates[this._mode+"_date"]){var a=this._els.dhx_cal_header[0],b=this._els.dhx_cal_data[0],c=this.config;a.innerHTML="";b.innerHTML="";b.className="dhx_cal_data"+((c.readonly||!c.drag_resize?" dhx_resize_denied":"")+(c.readonly||!c.drag_move?" dhx_move_denied":""));this._scales={};this._cols=[];this._colsS={height:0};this._dy_shift=0;this.set_sizes();var d,e=this._get_timeunit_start(),f=scheduler._get_view_end();this._min_date=d=this._table_view?scheduler.date.week_start(e):
e;this._els.dhx_cal_date[0].innerHTML=this.templates[this._mode+"_date"](e,f,this._mode);this._max_date=f;scheduler._render_scales(a,b);this._table_view?this._reset_month_scale(b,e,d):(this._reset_hours_scale(b,e,d),c.multi_day&&(this._els.dhx_multi_day&&(this._els.dhx_multi_day[0].parentNode.removeChild(this._els.dhx_multi_day[0]),this._els.dhx_multi_day=null),a=this._els.dhx_cal_navline[0].offsetHeight+this._els.dhx_cal_header[0].offsetHeight+1,c=document.createElement("DIV"),c.className="dhx_multi_day",
c.style.visibility="hidden",this.set_xy(c,Math.max(this._colsS[this._colsS.col_length]+this.xy.scroll_width-2,0),0,0,a),b.parentNode.insertBefore(c,b),b=c.cloneNode(!0),b.className="dhx_multi_day_icon",b.style.visibility="hidden",this.set_xy(b,this.xy.scale_width,0,0,a),c.appendChild(b),this._els.dhx_multi_day=[c,b],this._els.dhx_multi_day[0].onclick=this._click.dhx_cal_data))}};
scheduler._reset_hours_scale=function(a,b,c){b=document.createElement("DIV");b.className="dhx_scale_holder";c=new Date(1980,1,1,this.config.first_hour,0,0);for(var d=1*this.config.first_hour;d<this.config.last_hour;d++){var e=document.createElement("DIV");e.className="dhx_scale_hour";e.style.height=this.config.hour_size_px-(this._quirks?0:1)+"px";var f=this.xy.scale_width;this.config.left_border&&(--f,e.className+=" dhx_scale_hour_border");e.style.width=f+"px";e.innerHTML=scheduler.templates.hour_scale(c);
b.appendChild(e);c=this.date.add(c,1,"hour")}a.appendChild(b);this.config.scroll_hour&&(a.scrollTop=this.config.hour_size_px*(this.config.scroll_hour-this.config.first_hour))};scheduler._currentDate=function(){return scheduler.config.now_date?new Date(scheduler.config.now_date):new Date};
scheduler._process_ignores=function(a,b,c,d,e){this._ignores={};this._ignores_detected=0;var f=scheduler["ignore_"+this._mode];if(f){a=new Date(a);for(var g=0;g<b;g++)f(a)&&(this._ignores_detected+=1,this._ignores[g]=!0,e&&b++),a=scheduler.date.add(a,d,c),scheduler.date[c+"_start"]&&(a=scheduler.date[c+"_start"](a))}};
scheduler._render_month_scale=function(a,b,c){function d(a){var b=scheduler._colsS.height;void 0!==scheduler._colsS.heights[a+1]&&(b=scheduler._colsS.heights[a+1]-(scheduler._colsS.heights[a]||0));return b}var e=scheduler.date.add(b,1,"month"),f=new Date(c),g=scheduler._currentDate();this.date.date_part(g);this.date.date_part(c);for(var k=Math.ceil(Math.round((e.valueOf()-c.valueOf())/864E5)/7),l=[],h=0;7>=h;h++){var m=(this._cols[h]||0)-1;0===h&&this.config.left_border&&--m;l[h]=" style='width:"+
m+"px;"}for(var p=0,n="<table cellpadding='0' cellspacing='0'>",m=[],h=0;h<k;h++){for(var n=n+"<tr>",q=Math.max(d(h)-scheduler.xy.month_head_height,0),v=0;7>v;v++){var n=n+"<td",u="";c<b?u="dhx_before":c>=e?u="dhx_after":c.valueOf()==g.valueOf()&&(u="dhx_now");this._ignores_detected&&this._ignores[v]&&(u+=" dhx_scale_ignore");var n=n+(" class='"+u+" "+this.templates.month_date_class(c,g)+"' >"),u="dhx_month_body",x="dhx_month_head";0===v&&this.config.left_border&&(u+=" dhx_month_body_border",x+=" dhx_month_head_border");
this._ignores_detected&&this._ignores[v]?n+="<div></div><div></div>":(n+="<div class='"+x+"'>"+this.templates.month_day(c)+"</div>",n+="<div class='"+u+"' "+l[v]+";height:"+q+"px;'></div></td>");m.push(c);u=c.getDate();c=this.date.add(c,1,"day");1<c.getDate()-u&&(c=new Date(c.getFullYear(),c.getMonth(),u+1,12,0))}n+="</tr>";scheduler._colsS.heights[h]=p;p+=d(h)}this._min_date=f;this._max_date=c;a.innerHTML=n+"</table>";this._scales={};b=a.getElementsByTagName("div");for(h=0;h<m.length;h++)a=b[2*h+
1],c=m[h],this._scales[+c]=a;for(h=0;h<m.length;h++)c=m[h],this.callEvent("onScaleAdd",[this._scales[+c],c]);return this._max_date};
scheduler._reset_month_scale=function(a,b,c){var d=scheduler.date.add(b,1,"month"),e=scheduler._currentDate();this.date.date_part(e);this.date.date_part(c);d=Math.ceil(Math.round((d.valueOf()-c.valueOf())/864E5)/7);this._colsS.height=Math.floor(a.clientHeight/d)-this.xy.month_head_height+this.xy.month_head_height;this._colsS.heights=[];return scheduler._render_month_scale(a,b,c)};
scheduler.getLabel=function(a,b){for(var c=this.config.lightbox.sections,d=0;d<c.length;d++)if(c[d].map_to==a)for(var e=c[d].options,f=0;f<e.length;f++)if(e[f].key==b)return e[f].label;return""};scheduler.updateCollection=function(a,b){var c=scheduler.serverList(a);if(!c)return!1;c.splice(0,c.length);c.push.apply(c,b||[]);scheduler.callEvent("onOptionsLoad",[]);scheduler.resetLightbox();return!0};
scheduler._lame_clone=function(a,b){var c,d,e;b=b||[];for(c=0;c<b.length;c+=2)if(a===b[c])return b[c+1];if(a&&"object"==typeof a){e={};d=[Array,Date,Number,String,Boolean];for(c=0;c<d.length;c++)a instanceof d[c]&&(e=c?new d[c](a):new d[c]);b.push(a,e);for(c in a)Object.prototype.hasOwnProperty.apply(a,[c])&&(e[c]=scheduler._lame_clone(a[c],b))}return e||a};scheduler._lame_copy=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};
scheduler._get_date_from_pos=function(a){return new Date(this._correct_shift(this._min_date.valueOf()+6E4*(a.y*this.config.time_step+1440*(this._table_view?0:a.x))))};scheduler.getActionData=function(a){a=this._mouse_coords(a);return{date:this._get_date_from_pos(a),section:a.section}};scheduler._focus=function(a,b){a&&a.focus&&(this.config.touch?window.setTimeout(function(){a.focus()},100):(b&&a.select&&a.select(),a.focus()))};
scheduler._get_real_event_length=function(a,b,c){var d=b-a,e=c._start_correction+c._end_correction||0,f=this["ignore_"+this._mode],g=0;c.render?(g=this._get_date_index(c,a),a=this._get_date_index(c,b)):a=Math.round(d/60/60/1E3/24);for(;g<a;){var k=scheduler.date.add(b,-c.x_step,c.x_unit),d=f&&f(b)?d-(b-k):d-e;b=k;a--}return d};
scheduler._get_fictional_event_length=function(a,b,c,d){var e=new Date(a),f=d?-1:1;if(c._start_correction||c._end_correction){var g;g=d?60*e.getHours()+e.getMinutes()-60*(c.first_hour||0):60*(c.last_hour||0)-(60*e.getHours()+e.getMinutes());d=60*(c.last_hour-c.first_hour);g=Math.ceil((b/6E4-g)/d);b+=g*(1440-d)*6E4}g=new Date(1*a+b*f);a=this["ignore_"+this._mode];d=0;c.render?(d=this._get_date_index(c,e),g=this._get_date_index(c,g)):g=Math.round(b/60/60/1E3/24);for(;d*f<=g*f;){var k=scheduler.date.add(e,
c.x_step*f,c.x_unit);a&&a(e)&&(b+=(k-e)*f,g+=f);e=k;d+=f}return b};scheduler._get_section_view=function(){return this.matrix&&this.matrix[this._mode]?this.matrix[this._mode]:this._props&&this._props[this._mode]?this._props[this._mode]:null};scheduler._get_section_property=function(){return this.matrix&&this.matrix[this._mode]?this.matrix[this._mode].y_property:this._props&&this._props[this._mode]?this._props[this._mode].map_to:null};
scheduler._is_initialized=function(){var a=this.getState();return this._obj&&a.date&&a.mode};scheduler._is_lightbox_open=function(){var a=this.getState();return null!==a.lightbox_id&&void 0!==a.lightbox_id};
scheduler.date={init:function(){for(var a=scheduler.locale.date.month_short,b=scheduler.locale.date.month_short_hash={},c=0;c<a.length;c++)b[a[c]]=c;a=scheduler.locale.date.month_full;b=scheduler.locale.date.month_full_hash={};for(c=0;c<a.length;c++)b[a[c]]=c},date_part:function(a){var b=new Date(a);a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);a.getHours()&&(a.getDate()<b.getDate()||a.getMonth()<b.getMonth()||a.getFullYear()<b.getFullYear())&&a.setTime(a.getTime()+36E5*(24-a.getHours()));
return a},time_part:function(a){return(a.valueOf()/1E3-60*a.getTimezoneOffset())%86400},week_start:function(a){var b=a.getDay();scheduler.config.start_on_monday&&(0===b?b=6:b--);return this.date_part(this.add(a,-1*b,"day"))},month_start:function(a){a.setDate(1);return this.date_part(a)},year_start:function(a){a.setMonth(0);return this.month_start(a)},day_start:function(a){return this.date_part(a)},_add_days:function(a,b){var c=new Date(a.valueOf());c.setDate(c.getDate()+b);!a.getHours()&&c.getHours()&&
(c.getDate()<a.getDate()||c.getMonth()<a.getMonth()||c.getFullYear()<a.getFullYear())&&c.setTime(c.getTime()+36E5*(24-c.getHours()));return c},add:function(a,b,c){var d=new Date(a.valueOf());switch(c){case "day":d=scheduler.date._add_days(d,b);break;case "week":d=scheduler.date._add_days(d,7*b);break;case "month":d.setMonth(d.getMonth()+b);break;case "year":d.setYear(d.getFullYear()+b);break;case "hour":d.setTime(d.getTime()+36E5*b);break;case "minute":d.setTime(d.getTime()+6E4*b);break;default:return scheduler.date["add_"+
c](a,b,c)}return d},to_fixed:function(a){return 10>a?"0"+a:a},copy:function(a){return new Date(a.valueOf())},date_to_str:function(a,b){a=a.replace(/%[a-zA-Z]/g,function(a){switch(a){case "%d":return'"+scheduler.date.to_fixed(date.getDate())+"';case "%m":return'"+scheduler.date.to_fixed((date.getMonth()+1))+"';case "%j":return'"+date.getDate()+"';case "%n":return'"+(date.getMonth()+1)+"';case "%y":return'"+scheduler.date.to_fixed(date.getFullYear()%100)+"';case "%Y":return'"+date.getFullYear()+"';
case "%D":return'"+scheduler.locale.date.day_short[date.getDay()]+"';case "%l":return'"+scheduler.locale.date.day_full[date.getDay()]+"';case "%M":return'"+scheduler.locale.date.month_short[date.getMonth()]+"';case "%F":return'"+scheduler.locale.date.month_full[date.getMonth()]+"';case "%h":return'"+scheduler.date.to_fixed((date.getHours()+11)%12+1)+"';case "%g":return'"+((date.getHours()+11)%12+1)+"';case "%G":return'"+date.getHours()+"';case "%H":return'"+scheduler.date.to_fixed(date.getHours())+"';
case "%i":return'"+scheduler.date.to_fixed(date.getMinutes())+"';case "%a":return'"+(date.getHours()>11?"pm":"am")+"';case "%A":return'"+(date.getHours()>11?"PM":"AM")+"';case "%s":return'"+scheduler.date.to_fixed(date.getSeconds())+"';case "%W":return'"+scheduler.date.to_fixed(scheduler.date.getISOWeek(date))+"';default:return a}});b&&(a=a.replace(/date\.get/g,"date.getUTC"));return new Function("date",'return "'+a+'";')},str_to_date:function(a,b){for(var c="var temp=date.match(/[a-zA-Z]+|[0-9]+/g);",
d=a.match(/%[a-zA-Z]/g),e=0;e<d.length;e++)switch(d[e]){case "%j":case "%d":c+="set[2]=temp["+e+"]||1;";break;case "%n":case "%m":c+="set[1]=(temp["+e+"]||1)-1;";break;case "%y":c+="set[0]=temp["+e+"]*1+(temp["+e+"]>50?1900:2000);";break;case "%g":case "%G":case "%h":case "%H":c+="set[3]=temp["+e+"]||0;";break;case "%i":c+="set[4]=temp["+e+"]||0;";break;case "%Y":c+="set[0]=temp["+e+"]||0;";break;case "%a":case "%A":c+="set[3]=set[3]%12+((temp["+e+"]||'').toLowerCase()=='am'?0:12);";break;case "%s":c+=
"set[5]=temp["+e+"]||0;";break;case "%M":c+="set[1]=scheduler.locale.date.month_short_hash[temp["+e+"]]||0;";break;case "%F":c+="set[1]=scheduler.locale.date.month_full_hash[temp["+e+"]]||0;"}d="set[0],set[1],set[2],set[3],set[4],set[5]";b&&(d=" Date.UTC("+d+")");return new Function("date","var set=[0,0,1,0,0,0]; "+c+" return new Date("+d+");")},getISOWeek:function(a){if(!a)return!1;var b=a.getDay();0===b&&(b=7);var c=new Date(a.valueOf());c.setDate(a.getDate()+(4-b));a=c.getFullYear();c=Math.round((c.getTime()-
(new Date(a,0,1)).getTime())/864E5);return 1+Math.floor(c/7)},getUTCISOWeek:function(a){return this.getISOWeek(this.convert_to_utc(a))},convert_to_utc:function(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds())}};
scheduler.locale={date:{month_full:"January February March April May June July August September October November December".split(" "),month_short:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),day_full:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),day_short:"Sun Mon Tue Wed Thu Fri Sat".split(" ")},labels:{dhx_cal_today_button:"Today",day_tab:"Day",week_tab:"Week",month_tab:"Month",new_event:"New event",icon_save:"Save",icon_cancel:"Cancel",icon_details:"Details",
icon_edit:"Edit",icon_delete:"Delete",confirm_closing:"",confirm_deleting:"Event will be deleted permanently, are you sure?",section_description:"Description",section_time:"Time period",full_day:"Full day",confirm_recurring:"Do you want to edit the whole set of repeated events?",section_recurring:"Repeat event",button_recurring:"Disabled",button_recurring_open:"Enabled",button_edit_series:"Edit series",button_edit_occurrence:"Edit occurrence",agenda_tab:"Agenda",date:"Date",description:"Description",
year_tab:"Year",week_agenda_tab:"Agenda",grid_tab:"Grid",drag_to_create:"Drag to create",drag_to_move:"Drag to move",message_ok:"OK",message_cancel:"Cancel"}};
scheduler.config={default_date:"%j %M %Y",month_date:"%F %Y",load_date:"%Y-%m-%d",week_date:"%l",day_date:"%D, %F %j",hour_date:"%H:%i",month_day:"%d",xml_date:"%m/%d/%Y %H:%i",api_date:"%d-%m-%Y %H:%i",preserve_length:!0,time_step:5,start_on_monday:1,first_hour:0,last_hour:24,readonly:!1,drag_resize:1,drag_move:1,drag_create:1,dblclick_create:1,edit_on_create:1,details_on_create:0,resize_month_events:!1,resize_month_timed:!1,cascade_event_display:!1,cascade_event_count:4,cascade_event_margin:30,
multi_day:!0,multi_day_height_limit:0,drag_lightbox:!0,preserve_scroll:!0,select:!0,server_utc:!1,touch:!0,touch_tip:!0,touch_drag:500,quick_info_detached:!0,positive_closing:!1,drag_highlight:!0,limit_drag_out:!1,icons_edit:["icon_save","icon_cancel"],icons_select:["icon_details","icon_edit","icon_delete"],buttons_left:["dhx_save_btn","dhx_cancel_btn"],buttons_right:["dhx_delete_btn"],lightbox:{sections:[{name:"description",height:200,map_to:"text",type:"textarea",focus:!0},{name:"time",height:72,
type:"time",map_to:"auto"}]},highlight_displayed_event:!0,left_border:!1,ajax_error:"alert",delay_render:0};scheduler.templates={};
scheduler.init_templates=function(){var a=scheduler.locale.labels;a.dhx_save_btn=a.icon_save;a.dhx_cancel_btn=a.icon_cancel;a.dhx_delete_btn=a.icon_delete;var a=scheduler.date.date_to_str,b=scheduler.config;(function(a,b){for(var e in b)a[e]||(a[e]=b[e])})(scheduler.templates,{day_date:a(b.default_date),month_date:a(b.month_date),week_date:function(a,b){return scheduler.templates.day_date(a)+" &ndash; "+scheduler.templates.day_date(scheduler.date.add(b,-1,"day"))},day_scale_date:a(b.default_date),
month_scale_date:a(b.week_date),week_scale_date:a(b.day_date),hour_scale:a(b.hour_date),time_picker:a(b.hour_date),event_date:a(b.hour_date),month_day:a(b.month_day),xml_date:scheduler.date.str_to_date(b.xml_date,b.server_utc),load_format:a(b.load_date,b.server_utc),xml_format:a(b.xml_date,b.server_utc),api_date:scheduler.date.str_to_date(b.api_date),event_header:function(a,b,e){return scheduler.templates.event_date(a)+" - "+scheduler.templates.event_date(b)},event_text:function(a,b,e){return e.text},
event_class:function(a,b,e){return""},month_date_class:function(a){return""},week_date_class:function(a){return""},event_bar_date:function(a,b,e){return scheduler.templates.event_date(a)+" "},event_bar_text:function(a,b,e){return e.text},month_events_link:function(a,b){return"<a>View more("+b+" events)</a>"},drag_marker_class:function(a,b,e){return""},drag_marker_content:function(a,b,e){return""}});this.callEvent("onTemplatesReady",[])};
scheduler.uid=function(){this._seed||(this._seed=(new Date).valueOf());return this._seed++};scheduler._events={};scheduler.clearAll=function(){this._events={};this._loaded={};this._drag_pos=this._drag_mode=this._drag_id=this._select_id=this._edit_id=null;this.clear_view();this.callEvent("onClearAll",[])};
scheduler.addEvent=function(a,b,c,d,e){if(!arguments.length)return this.addEventNow();var f=a;1!=arguments.length&&(f=e||{},f.start_date=a,f.end_date=b,f.text=c,f.id=d);f.id=f.id||scheduler.uid();f.text=f.text||"";"string"==typeof f.start_date&&(f.start_date=this.templates.api_date(f.start_date));"string"==typeof f.end_date&&(f.end_date=this.templates.api_date(f.end_date));var g=6E4*(this.config.event_duration||this.config.time_step);f.start_date.valueOf()==f.end_date.valueOf()&&f.end_date.setTime(f.end_date.valueOf()+
g);f._timed=this.isOneDayEvent(f);g=!this._events[f.id];this._events[f.id]=f;this.event_updated(f);this._loading||this.callEvent(g?"onEventAdded":"onEventChanged",[f.id,f]);return f.id};scheduler.deleteEvent=function(a,b){var c=this._events[a];if(b||this.callEvent("onBeforeEventDelete",[a,c])&&this.callEvent("onConfirmedBeforeEventDelete",[a,c]))c&&(this._select_id=null,delete this._events[a],this.event_updated(c)),this.callEvent("onEventDeleted",[a,c])};scheduler.getEvent=function(a){return this._events[a]};
scheduler.setEvent=function(a,b){b.id||(b.id=a);this._events[a]=b};scheduler.for_rendered=function(a,b){for(var c=this._rendered.length-1;0<=c;c--)this._rendered[c].getAttribute("event_id")==a&&b(this._rendered[c],c)};
scheduler.changeEventId=function(a,b){if(a!=b){var c=this._events[a];c&&(c.id=b,this._events[b]=c,delete this._events[a]);this.for_rendered(a,function(a){a.setAttribute("event_id",b)});this._select_id==a&&(this._select_id=b);this._edit_id==a&&(this._edit_id=b);this.callEvent("onEventIdChange",[a,b])}};
(function(){for(var a="text Text start_date StartDate end_date EndDate".split(" "),b=function(a){return function(b){return scheduler.getEvent(b)[a]}},c=function(a){return function(b,c){var d=scheduler.getEvent(b);d[a]=c;d._changed=!0;d._timed=this.isOneDayEvent(d);scheduler.event_updated(d,!0)}},d=0;d<a.length;d+=2)scheduler["getEvent"+a[d+1]]=b(a[d]),scheduler["setEvent"+a[d+1]]=c(a[d])})();scheduler.event_updated=function(a,b){this.is_visible_events(a)?this.render_view_data():this.clear_event(a.id)};
scheduler.is_visible_events=function(a){return a.start_date<this._max_date&&this._min_date<a.end_date?this._table_view||a.end_date.getHours()>=this.config.first_hour&&a.end_date.getHours()<this.config.last_hour||a.start_date.getHours()>=this.config.first_hour&&a.start_date.getHours()<this.config.last_hour?!0:(a.end_date.valueOf()-a.start_date.valueOf())/36E5>24-(this.config.last_hour-this.config.first_hour):!1};
scheduler.isOneDayEvent=function(a){var b=a.end_date.getDate()-a.start_date.getDate();return b?(0>b&&(b=Math.ceil((a.end_date.valueOf()-a.start_date.valueOf())/864E5)),1==b&&!a.end_date.getHours()&&!a.end_date.getMinutes()&&(a.start_date.getHours()||a.start_date.getMinutes())):a.start_date.getMonth()==a.end_date.getMonth()&&a.start_date.getFullYear()==a.end_date.getFullYear()};
scheduler.get_visible_events=function(a){var b=[],c;for(c in this._events)this.is_visible_events(this._events[c])&&(!a||this._events[c]._timed)&&this.filter_event(c,this._events[c])&&b.push(this._events[c]);return b};scheduler.filter_event=function(a,b){var c=this["filter_"+this._mode];return c?c(a,b):!0};scheduler._is_main_area_event=function(a){return!!a._timed};
scheduler.render_view_data=function(a,b){if(!a){if(this._not_render){this._render_wait=!0;return}this._render_wait=!1;this.clear_view();a=this.get_visible_events(!(this._table_view||this.config.multi_day))}for(var c=0,d=a.length;c<d;c++)this._recalculate_timed(a[c]);if(this.config.multi_day&&!this._table_view){for(var d=[],e=[],c=0;c<a.length;c++)this._is_main_area_event(a[c])?d.push(a[c]):e.push(a[c]);this._rendered_location=this._els.dhx_multi_day[0];this._table_view=!0;this.render_data(e,b);this._table_view=
!1;this._rendered_location=this._els.dhx_cal_data[0];this._table_view=!1;this.render_data(d,b)}else this._rendered_location=this._els.dhx_cal_data[0],this.render_data(a,b)};scheduler._view_month_day=function(a){a=scheduler.getActionData(a).date;scheduler.callEvent("onViewMoreClick",[a])&&scheduler.setCurrentView(a,"day")};
scheduler._render_month_link=function(a){for(var b=this._rendered_location,c=this._lame_clone(a),d=a._sday;d<a._eday;d++){c._sday=d;c._eday=d+1;var e=scheduler.date,f=scheduler._min_date,f=e.add(f,c._sweek,"week"),f=e.add(f,c._sday,"day"),e=scheduler.getEvents(f,e.add(f,1,"day")).length,g=this._get_event_bar_pos(c),k=g.x2-g.x,l=document.createElement("div");l.onclick=function(a){scheduler._view_month_day(a||event)};l.className="dhx_month_link";l.style.top=g.y+"px";l.style.left=g.x+"px";l.style.width=
k+"px";l.innerHTML=scheduler.templates.month_events_link(f,e);this._rendered.push(l);b.appendChild(l)}};scheduler._recalculate_timed=function(a){a&&(a="object"!=typeof a?this._events[a]:a)&&(a._timed=scheduler.isOneDayEvent(a))};scheduler.attachEvent("onEventChanged",scheduler._recalculate_timed);scheduler.attachEvent("onEventAdded",scheduler._recalculate_timed);
scheduler.render_data=function(a,b){a=this._pre_render_events(a,b);for(var c=0;c<a.length;c++)if(this._table_view)if("month"!=scheduler._mode)this.render_event_bar(a[c]);else{var d=scheduler.config.max_month_events;d!==1*d||a[c]._sorder<d?this.render_event_bar(a[c]):void 0!==d&&a[c]._sorder==d&&scheduler._render_month_link(a[c])}else this.render_event(a[c])};
scheduler._get_first_visible_cell=function(a){for(var b=0;b<a.length;b++)if(-1==(a[b].className||"").indexOf("dhx_scale_ignore"))return a[b];return a[0]};
scheduler._pre_render_events=function(a,b){var c=this.xy.bar_height,d=this._colsS.heights,e=this._colsS.heights=[0,0,0,0,0,0,0],f=this._els.dhx_cal_data[0];a=this._table_view?this._pre_render_events_table(a,b):this._pre_render_events_line(a,b);if(this._table_view)if(b)this._colsS.heights=d;else if(d=f.firstChild,d.rows){for(f=0;f<d.rows.length;f++){e[f]++;var g=d.rows[f].cells,k=this._colsS.height-this.xy.month_head_height;if(e[f]*c>k){var l=k;1*this.config.max_month_events!==this.config.max_month_events||
e[f]<=this.config.max_month_events?l=e[f]*c:(this.config.max_month_events+1)*c>k&&(l=(this.config.max_month_events+1)*c);for(k=0;k<g.length;k++)g[k].childNodes[1].style.height=l+"px"}e[f]=(e[f-1]||0)+scheduler._get_first_visible_cell(g).offsetHeight}e.unshift(0);d.parentNode.offsetHeight<d.parentNode.scrollHeight&&!scheduler._colsS.scroll_fix&&scheduler.xy.scroll_width&&(c=scheduler._colsS,e=c[c.col_length],f=c.heights.slice(),e-=scheduler.xy.scroll_width||0,this._calc_scale_sizes(e,this._min_date,
this._max_date),scheduler._colsS.heights=f,this.set_xy(this._els.dhx_cal_header[0],e,this.xy.scale_height),scheduler._render_scales(this._els.dhx_cal_header[0]),scheduler._render_month_scale(this._els.dhx_cal_data[0],this._get_timeunit_start(),this._min_date),c.scroll_fix=!0)}else if(a.length||"visible"!=this._els.dhx_multi_day[0].style.visibility||(e[0]=-1),a.length||-1==e[0]){g=d=(e[0]+1)*c+1;l=d+"px";this.config.multi_day_height_limit&&(g=Math.min(d,this.config.multi_day_height_limit),l=g+"px");
f.style.top=this._els.dhx_cal_navline[0].offsetHeight+this._els.dhx_cal_header[0].offsetHeight+g+"px";f.style.height=this._obj.offsetHeight-parseInt(f.style.top,10)-(this.xy.margin_top||0)+"px";k=this._els.dhx_multi_day[0];k.style.height=l;k.style.visibility=-1==e[0]?"hidden":"visible";var h=this._els.dhx_multi_day[1];h.style.height=l;h.style.visibility=-1==e[0]?"hidden":"visible";h.className=e[0]?"dhx_multi_day_icon":"dhx_multi_day_icon_small";this._dy_shift=(e[0]+1)*c;this.config.multi_day_height_limit&&
(this._dy_shift=Math.min(this.config.multi_day_height_limit,this._dy_shift));e[0]=0;g!=d&&(f.style.top=parseInt(f.style.top)+2+"px",k.style.overflowY="auto",h.style.position="fixed",h.style.top="",h.style.left="")}return a};scheduler._get_event_sday=function(a){return Math.floor((a.start_date.valueOf()-this._min_date.valueOf())/864E5)};
scheduler._get_event_mapped_end_date=function(a){var b=a.end_date;this.config.separate_short_events&&(a=(a.end_date-a.start_date)/6E4,a<this._min_mapped_duration&&(b=this.date.add(b,this._min_mapped_duration-a,"minute")));return b};
scheduler._pre_render_events_line=function(a,b){a.sort(function(a,b){return a.start_date.valueOf()==b.start_date.valueOf()?a.id>b.id?1:-1:a.start_date>b.start_date?1:-1});var c=[],d=[];this._min_mapped_duration=Math.ceil(60*this.xy.min_event_height/this.config.hour_size_px);for(var e=0;e<a.length;e++){var f=a[e],g=f.end_date,k=f.start_date.getHours(),g=g.getHours();f._sday=this._get_event_sday(f);if(this._ignores[f._sday])a.splice(e,1),e--;else{c[f._sday]||(c[f._sday]=[]);if(!b){f._inner=!1;for(var l=
c[f._sday];l.length;){var h=l[l.length-1],m=this._get_event_mapped_end_date(h);if(m.valueOf()<=f.start_date.valueOf())l.splice(l.length-1,1);else break}for(var p=l.length,n=!1,q=0;q<l.length;q++)if(h=l[q],m=this._get_event_mapped_end_date(h),m.valueOf()<=f.start_date.valueOf()){n=!0;f._sorder=h._sorder;p=q;f._inner=!0;break}l.length&&(l[l.length-1]._inner=!0);if(!n)if(l.length)if(l.length<=l[l.length-1]._sorder){if(l[l.length-1]._sorder)for(q=0;q<l.length;q++){h=!1;for(m=0;m<l.length;m++)if(l[m]._sorder==
q){h=!0;break}if(!h){f._sorder=q;break}}else f._sorder=0;f._inner=!0}else{h=l[0]._sorder;for(q=1;q<l.length;q++)l[q]._sorder>h&&(h=l[q]._sorder);f._sorder=h+1;f._inner=!1}else f._sorder=0;l.splice(p,p==l.length?0:1,f);l.length>(l.max_count||0)?(l.max_count=l.length,f._count=l.length):f._count=f._count?f._count:1}if(k<this.config.first_hour||g>=this.config.last_hour)if(d.push(f),a[e]=f=this._copy_event(f),k<this.config.first_hour&&(f.start_date.setHours(this.config.first_hour),f.start_date.setMinutes(0)),
g>=this.config.last_hour&&(f.end_date.setMinutes(0),f.end_date.setHours(this.config.last_hour)),f.start_date>f.end_date||k==this.config.last_hour)a.splice(e,1),e--}}if(!b){for(e=0;e<a.length;e++)a[e]._count=c[a[e]._sday].max_count;for(e=0;e<d.length;e++)d[e]._count=c[d[e]._sday].max_count}return a};scheduler._time_order=function(a){a.sort(function(a,c){return a.start_date.valueOf()==c.start_date.valueOf()?a._timed&&!c._timed?1:!a._timed&&c._timed?-1:a.id>c.id?1:-1:a.start_date>c.start_date?1:-1})};
scheduler._pre_render_events_table=function(a,b){this._time_order(a);for(var c=[],d=[[],[],[],[],[],[],[]],e=this._colsS.heights,f,g=this._cols.length,k={},l=0;l<a.length;l++){var h=a[l],m=h.id;k[m]||(k[m]={first_chunk:!0,last_chunk:!0});var m=k[m],p=f||h.start_date,n=h.end_date;p<this._min_date&&(m.first_chunk=!1,p=this._min_date);n>this._max_date&&(m.last_chunk=!1,n=this._max_date);var q=this.locate_holder_day(p,!1,h);h._sday=q%g;if(!this._ignores[h._sday]||!h._timed){f=this.locate_holder_day(n,
!0,h)||g;h._eday=f%g||g;h._length=f-q;h._sweek=Math.floor((this._correct_shift(p.valueOf(),1)-this._min_date.valueOf())/(864E5*g));q=d[h._sweek];for(n=0;n<q.length&&!(q[n]._eday<=h._sday);n++);h._sorder&&b||(h._sorder=n);if(h._sday+h._length<=g)f=null,c.push(h),q[n]=h,e[h._sweek]=q.length-1,h._first_chunk=m.first_chunk,h._last_chunk=m.last_chunk;else{f=this._copy_event(h);f.id=h.id;f._length=g-h._sday;f._eday=g;f._sday=h._sday;f._sweek=h._sweek;f._sorder=h._sorder;f.end_date=this.date.add(p,f._length,
"day");if(f._first_chunk=m.first_chunk)m.first_chunk=!1;c.push(f);q[n]=f;f=f.end_date;e[h._sweek]=q.length-1;l--}}}return c};scheduler._copy_dummy=function(){var a=new Date(this.end_date);this.start_date=new Date(this.start_date);this.end_date=a};scheduler._copy_event=function(a){this._copy_dummy.prototype=a;return new this._copy_dummy};scheduler._rendered=[];
scheduler.clear_view=function(){for(var a=0;a<this._rendered.length;a++){var b=this._rendered[a];b.parentNode&&b.parentNode.removeChild(b)}this._rendered=[]};
scheduler.updateEvent=function(a){var b=this.getEvent(a);this.clear_event(a);b&&this.is_visible_events(b)&&this.filter_event(a,b)&&(this._table_view||this.config.multi_day||b._timed)&&(this.config.update_render?this.render_view_data():"month"!=this.getState().mode||this.getState().drag_id||this.isOneDayEvent(b)?this.render_view_data([b],!0):this.render_view_data())};
scheduler.clear_event=function(a){this.for_rendered(a,function(a,c){a.parentNode&&a.parentNode.removeChild(a);scheduler._rendered.splice(c,1)})};scheduler._y_from_date=function(a){a=60*a.getHours()+a.getMinutes();return Math.round((6E4*a-36E5*this.config.first_hour)*this.config.hour_size_px/36E5)%(24*this.config.hour_size_px)};
scheduler._calc_event_y=function(a,b){b=b||0;var c=60*a.start_date.getHours()+a.start_date.getMinutes(),d=60*a.end_date.getHours()+a.end_date.getMinutes()||60*scheduler.config.last_hour,e=this._y_from_date(a.start_date),c=Math.max(b,(d-c)*this.config.hour_size_px/60);return{top:e,height:c}};
scheduler.render_event=function(a){var b=scheduler.xy.menu_width,c=this.config.use_select_menu_space?0:b;if(!(0>a._sday)){var d=scheduler.locate_holder(a._sday);if(d){var e=this._calc_event_y(a,scheduler.xy.min_event_height),f=e.top,g=e.height,k=a._count||1,l=a._sorder||0,h=Math.floor((d.clientWidth-c)/k),e=l*h+1;a._inner||(h*=k-l);if(this.config.cascade_event_display)var h=this.config.cascade_event_count,m=this.config.cascade_event_margin,e=l%h*m,h=Math.floor(d.clientWidth-c-e-(a._inner?(k-l-1)%
h*m/2:0));k=this._render_v_bar(a,c+e,f,h,g,a._text_style,scheduler.templates.event_header(a.start_date,a.end_date,a),scheduler.templates.event_text(a.start_date,a.end_date,a));this._rendered.push(k);d.appendChild(k);e=e+parseInt(d.style.left,10)+c;if(this._edit_id==a.id){k.style.zIndex=1;h=Math.max(h-4,scheduler.xy.editor_width);k=document.createElement("DIV");k.setAttribute("event_id",a.id);this.set_xy(k,h,g-20,e,f+14);k.className="dhx_cal_event dhx_cal_editor";if(c=scheduler.templates.event_class(a.start_date,
a.end_date,a))k.className+=" "+c;c=document.createElement("DIV");this.set_xy(c,h-6,g-26);c.style.cssText+=";margin:2px 2px 2px 2px;overflow:hidden;";k.appendChild(c);this._els.dhx_cal_data[0].appendChild(k);this._rendered.push(k);c.innerHTML="<textarea class='dhx_cal_editor'>"+a.text+"</textarea>";this._quirks7&&(c.firstChild.style.height=g-12+"px");this._editor=c.firstChild;this._editor.onkeydown=function(a){if((a||event).shiftKey)return!0;a=(a||event).keyCode;a==scheduler.keys.edit_save&&scheduler.editStop(!0);
a==scheduler.keys.edit_cancel&&scheduler.editStop(!1)};this._editor.onselectstart=function(a){return(a||event).cancelBubble=!0};scheduler._focus(c.firstChild,!0);this._els.dhx_cal_data[0].scrollLeft=0}if(0!==this.xy.menu_width&&this._select_id==a.id){this.config.cascade_event_display&&this._drag_mode&&(k.style.zIndex=1);g=this.config["icons_"+(this._edit_id==a.id?"edit":"select")];c="";d=a.color?"background-color: "+a.color+";":"";h=a.textColor?"color: "+a.textColor+";":"";for(k=0;k<g.length;k++)c+=
"<div class='dhx_menu_icon "+g[k]+"' style='"+d+""+h+"' title='"+this.locale.labels[g[k]]+"'></div>";f=this._render_v_bar(a,e-b+1,f,b,20*g.length+26-2,"","<div style='"+d+""+h+"' class='dhx_menu_head'></div>",c,!0);f.style.left=e-b+1;this._els.dhx_cal_data[0].appendChild(f);this._rendered.push(f)}this.config.drag_highlight&&this._drag_id==a.id&&this.highlightEventPosition(a)}}};
scheduler._render_v_bar=function(a,b,c,d,e,f,g,k,l){var h=document.createElement("DIV"),m=a.id,p=l?"dhx_cal_event dhx_cal_select_menu":"dhx_cal_event",n=scheduler.templates.event_class(a.start_date,a.end_date,a);n&&(p=p+" "+n);var n=a.color?"background:"+a.color+";":"",q=a.textColor?"color:"+a.textColor+";":"";h.innerHTML='<div event_id="'+m+'" class="'+p+'" style="position:absolute; top:'+c+"px; left:"+b+"px; width:"+(d-4)+"px; height:"+e+"px;"+(f||"")+'"></div>';b=h.cloneNode(!0).firstChild;if(l||
!scheduler.renderEvent(b,a,d,e,g,k))b=h.firstChild,a='<div class="dhx_event_move dhx_header" style=" width:'+(d-6)+"px;"+n+'" >&nbsp;</div>'+('<div class="dhx_event_move dhx_title" style="'+n+""+q+'">'+g+"</div>"),a+='<div class="dhx_body" style=" width:'+(d-(this._quirks?4:14))+"px; height:"+(e-(this._quirks?20:30)+1)+"px;"+n+""+q+'">'+k+"</div>",e="dhx_event_resize dhx_footer",l&&(e="dhx_resize_denied "+e),a+='<div class="'+e+'" style=" width:'+(d-8)+"px;"+(l?" margin-top:-1px;":"")+""+n+""+q+'" ></div>',
b.innerHTML=a;return b};scheduler.renderEvent=function(){return!1};scheduler.locate_holder=function(a){return"day"==this._mode?this._els.dhx_cal_data[0].firstChild:this._els.dhx_cal_data[0].childNodes[a]};scheduler.locate_holder_day=function(a,b){var c=Math.floor((this._correct_shift(a,1)-this._min_date)/864E5);b&&this.date.time_part(a)&&c++;return c};
scheduler._get_dnd_order=function(a,b,c){if(!this._drag_event)return a;this._drag_event._orig_sorder?a=this._drag_event._orig_sorder:this._drag_event._orig_sorder=a;for(var d=b*a;d+b>c;)a--,d-=b;return a=Math.max(a,0)};
scheduler._get_event_bar_pos=function(a){var b=this._colsS[a._sday],c=this._colsS[a._eday];c==b&&(c=this._colsS[a._eday+1]);var d=this.xy.bar_height,e=a._sorder;a.id==this._drag_id&&(e=scheduler._get_dnd_order(e,d,this._colsS.heights[a._sweek+1]-this._colsS.heights[a._sweek]-this.xy.month_head_height));return{x:b,x2:c,y:this._colsS.heights[a._sweek]+(this._colsS.height?this.xy.month_scale_height+2:2)+e*d}};
scheduler.render_event_bar=function(a){var b=this._rendered_location,c=this._get_event_bar_pos(a),d=c.y,e=c.x,f=c.x2,c="";if(f){var g=scheduler.config.resize_month_events&&"month"==this._mode&&(!a._timed||scheduler.config.resize_month_timed),k=document.createElement("DIV"),l=a.hasOwnProperty("_first_chunk")&&a._first_chunk,h=a.hasOwnProperty("_last_chunk")&&a._last_chunk,m=g&&(a._timed||l),p=g&&(a._timed||h),n="dhx_cal_event_clear";if(!a._timed||g)n="dhx_cal_event_line";l&&(n+=" dhx_cal_event_line_start");
h&&(n+=" dhx_cal_event_line_end");m&&(c+="<div class='dhx_event_resize dhx_event_resize_start'></div>");p&&(c+="<div class='dhx_event_resize dhx_event_resize_end'></div>");(l=scheduler.templates.event_class(a.start_date,a.end_date,a))&&(n+=" "+l);d=["position:absolute","top:"+d+"px","left:"+e+"px","width:"+(f-e-15)+"px",a.textColor?"color:"+a.textColor+";":"",a.color?"background:"+a.color+";":"",a._text_style||""].join(";");d='<div event_id="'+a.id+'" class="'+n+'" style="'+d+'">';g&&(d+=c);"month"==
scheduler.getState().mode&&(a=scheduler.getEvent(a.id));a._timed&&(d+=scheduler.templates.event_bar_date(a.start_date,a.end_date,a));d+=scheduler.templates.event_bar_text(a.start_date,a.end_date,a)+"</div>";k.innerHTML=d+"</div>";this._rendered.push(k.firstChild);b.appendChild(k.firstChild)}};scheduler._locate_event=function(a){for(var b=null;a&&!b&&a.getAttribute;)b=a.getAttribute("event_id"),a=a.parentNode;return b};
scheduler.edit=function(a){this._edit_id!=a&&(this.editStop(!1,a),this._edit_id=a,this.updateEvent(a))};scheduler.editStop=function(a,b){if(!b||this._edit_id!=b){var c=this.getEvent(this._edit_id);c&&(a&&(c.text=this._editor.value),this._editor=this._edit_id=null,this.updateEvent(c.id),this._edit_stop_event(c,a))}};
scheduler._edit_stop_event=function(a,b){this._new_event?(b?this.callEvent("onEventAdded",[a.id,a]):a&&this.deleteEvent(a.id,!0),this._new_event=null):b&&this.callEvent("onEventChanged",[a.id,a])};scheduler.getEvents=function(a,b){var c=[],d;for(d in this._events){var e=this._events[d];e&&(!a&&!b||e.start_date<b&&e.end_date>a)&&c.push(e)}return c};scheduler.getRenderedEvent=function(a){if(a){for(var b=scheduler._rendered,c=0;c<b.length;c++){var d=b[c];if(d.getAttribute("event_id")==a)return d}return null}};
scheduler.showEvent=function(a,b){var c="number"==typeof a||"string"==typeof a?scheduler.getEvent(a):a;b=b||scheduler._mode;if(c&&(!this.checkEvent("onBeforeEventDisplay")||this.callEvent("onBeforeEventDisplay",[c,b]))){var d=scheduler.config.scroll_hour;scheduler.config.scroll_hour=c.start_date.getHours();var e=scheduler.config.preserve_scroll;scheduler.config.preserve_scroll=!1;var f=c.color,g=c.textColor;scheduler.config.highlight_displayed_event&&(c.color=scheduler.config.displayed_event_color,
c.textColor=scheduler.config.displayed_event_text_color);scheduler.setCurrentView(new Date(c.start_date),b);c.color=f;c.textColor=g;scheduler.config.scroll_hour=d;scheduler.config.preserve_scroll=e;scheduler.matrix&&scheduler.matrix[b]&&(scheduler._els.dhx_cal_data[0].scrollTop=getAbsoluteTop(scheduler.getRenderedEvent(c.id))-getAbsoluteTop(scheduler._els.dhx_cal_data[0])-20);scheduler.callEvent("onAfterEventDisplay",[c,b])}};
scheduler._append_drag_marker=function(a){if(!a.parentNode){var b=scheduler._els.dhx_cal_data[0].lastChild;b.className&&0>b.className.indexOf("dhx_scale_holder")&&b.previousSibling&&(b=b.previousSibling);b&&0===b.className.indexOf("dhx_scale_holder")&&b.appendChild(a)}};scheduler._update_marker_position=function(a,b){var c=scheduler._calc_event_y(b,0);a.style.top=c.top+"px";a.style.height=c.height+"px"};
scheduler.highlightEventPosition=function(a){var b=document.createElement("div");b.setAttribute("event_id",a.id);this._rendered.push(b);this._update_marker_position(b,a);var c=this.templates.drag_marker_class(a.start_date,a.end_date,a);a=this.templates.drag_marker_content(a.start_date,a.end_date,a);b.className="dhx_drag_marker";c&&(b.className+=" "+c);a&&(b.innerHTML=a);this._append_drag_marker(b)};scheduler._loaded={};
scheduler._load=function(a,b){if(a=a||this._load_url){a+=(-1==a.indexOf("?")?"?":"&")+"timeshift="+(new Date).getTimezoneOffset();this.config.prevent_cache&&(a+="&uid="+this.uid());var c;b=b||this._date;if(this._load_mode){var d=this.templates.load_format;for(b=this.date[this._load_mode+"_start"](new Date(b.valueOf()));b>this._min_date;)b=this.date.add(b,-1,this._load_mode);c=b;for(var e=!0;c<this._max_date;)c=this.date.add(c,1,this._load_mode),this._loaded[d(b)]&&e?b=this.date.add(b,1,this._load_mode):
e=!1;e=c;do c=e,e=this.date.add(c,-1,this._load_mode);while(e>b&&this._loaded[d(e)]);if(c<=b)return!1;for(dhtmlxAjax.get(a+"&from="+d(b)+"&to="+d(c),function(a){scheduler.on_load(a)});b<c;)this._loaded[d(b)]=!0,b=this.date.add(b,1,this._load_mode)}else dhtmlxAjax.get(a,function(a){scheduler.on_load(a)});this.callEvent("onXLS",[]);return!0}};
scheduler.on_load=function(a){var b,c=!1;if(this._process&&"xml"!=this._process)try{b=this[this._process].parse(a.xmlDoc.responseText)}catch(d){c=!0}else(b=this._magic_parser(a))||(c=!0);c&&(this.callEvent("onLoadError",[a.xmlDoc]),b=[]);scheduler._process_loading(b);this.callEvent("onXLE",[])};
scheduler._process_loading=function(a){this._not_render=this._loading=!0;for(var b=0;b<a.length;b++)this.callEvent("onEventLoading",[a[b]])&&this.addEvent(a[b]);this._not_render=!1;this._render_wait&&this.render_view_data();this._loading=!1;this._after_call&&this._after_call();this._after_call=null};scheduler._init_event=function(a){a.text=a.text||a._tagvalue||"";a.start_date=scheduler._init_date(a.start_date);a.end_date=scheduler._init_date(a.end_date)};
scheduler._init_date=function(a){return a?"string"==typeof a?scheduler.templates.xml_date(a):new Date(a):null};scheduler.json={};
scheduler.json.parse=function(a){"string"==typeof a&&(scheduler._temp=eval("("+a+")"),a=scheduler._temp?scheduler._temp.data||scheduler._temp.d||scheduler._temp:[]);a.dhx_security&&(dhtmlx.security_key=a.dhx_security);var b=scheduler._temp&&scheduler._temp.collections?scheduler._temp.collections:{},c=!1,d;for(d in b)if(b.hasOwnProperty(d)){var c=!0,e=b[d],f=scheduler.serverList[d];if(f){f.splice(0,f.length);for(var g=0;g<e.length;g++){var k=e[g],l={key:k.value,label:k.label},h;for(h in k)k.hasOwnProperty(h)&&
"value"!=h&&"label"!=h&&(l[h]=k[h]);f.push(l)}}}c&&scheduler.callEvent("onOptionsLoad",[]);b=[];for(c=0;c<a.length;c++)d=a[c],scheduler._init_event(d),b.push(d);return b};scheduler.parse=function(a,b){this._process=b;this.on_load({xmlDoc:{responseText:a}})};scheduler.load=function(a,b,c){"string"==typeof b&&(this._process=b,b=c);this._load_url=a;this._after_call=b;this._load(a,this._date)};scheduler.setLoadMode=function(a){"all"==a&&(a="");this._load_mode=a};
scheduler.serverList=function(a,b){if(b)return this.serverList[a]=b.slice(0),this.serverList[a];this.serverList[a]=this.serverList[a]||[];return this.serverList[a]};scheduler._userdata={};
scheduler._magic_parser=function(a){var b;if(!a.getXMLTopNode){var c=a.xmlDoc.responseText;a=new dtmlXMLLoaderObject(function(){});a.loadXMLString(c)}b=a.getXMLTopNode("data");if("data"!=b.tagName)return null;if(c=b.getAttribute("dhx_security"))dhtmlx.security_key=c;b=a.doXPath("//coll_options");for(c=0;c<b.length;c++){var d=b[c].getAttribute("for");if(d=this.serverList[d]){d.splice(0,d.length);for(var e=a.doXPath(".//item",b[c]),f=0;f<e.length;f++){for(var g=e[f].attributes,k={key:e[f].getAttribute("value"),
label:e[f].getAttribute("label")},l=0;l<g.length;l++){var h=g[l];"value"!=h.nodeName&&"label"!=h.nodeName&&(k[h.nodeName]=h.nodeValue)}d.push(k)}}}b.length&&scheduler.callEvent("onOptionsLoad",[]);b=a.doXPath("//userdata");for(c=0;c<b.length;c++)d=this._xmlNodeToJSON(b[c]),this._userdata[d.name]=d.text;d=[];b=a.doXPath("//event");for(c=0;c<b.length;c++)a=d[c]=this._xmlNodeToJSON(b[c]),scheduler._init_event(a);return d};
scheduler._xmlNodeToJSON=function(a){for(var b={},c=0;c<a.attributes.length;c++)b[a.attributes[c].name]=a.attributes[c].value;for(c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];1==d.nodeType&&(b[d.tagName]=d.firstChild?d.firstChild.nodeValue:"")}b.text||(b.text=a.firstChild?a.firstChild.nodeValue:"");return b};
scheduler.attachEvent("onXLS",function(){if(!0===this.config.show_loading){var a;a=this.config.show_loading=document.createElement("DIV");a.className="dhx_loading";a.style.left=Math.round((this._x-128)/2)+"px";a.style.top=Math.round((this._y-15)/2)+"px";this._obj.appendChild(a)}});scheduler.attachEvent("onXLE",function(){var a=this.config.show_loading;a&&"object"==typeof a&&(this._obj.removeChild(a),this.config.show_loading=!0)});
scheduler.ical={parse:function(a){a=a.match(RegExp(this.c_start+"[^\f]*"+this.c_end,""));if(a.length){a[0]=a[0].replace(/[\r\n]+(?=[a-z \t])/g," ");a[0]=a[0].replace(/\;[^:\r\n]*:/g,":");for(var b=[],c,d=RegExp("(?:"+this.e_start+")([^\f]*?)(?:"+this.e_end+")","g");null!==(c=d.exec(a));){for(var e={},f,g=/[^\r\n]+[\r\n]+/g;null!==(f=g.exec(c[1]));)this.parse_param(f.toString(),e);e.uid&&!e.id&&(e.id=e.uid);b.push(e)}return b}},parse_param:function(a,b){var c=a.indexOf(":");if(-1!=c){var d=a.substr(0,
c).toLowerCase(),c=a.substr(c+1).replace(/\\\,/g,",").replace(/[\r\n]+$/,"");"summary"==d?d="text":"dtstart"==d?(d="start_date",c=this.parse_date(c,0,0)):"dtend"==d&&(d="end_date",c=this.parse_date(c,0,0));b[d]=c}},parse_date:function(a,b,c){a=a.split("T");a[1]&&(b=a[1].substr(0,2),c=a[1].substr(2,2));var d=a[0].substr(0,4),e=parseInt(a[0].substr(4,2),10)-1,f=a[0].substr(6,2);return scheduler.config.server_utc&&!a[1]?new Date(Date.UTC(d,e,f,b,c)):new Date(d,e,f,b,c)},c_start:"BEGIN:VCALENDAR",e_start:"BEGIN:VEVENT",
e_end:"END:VEVENT",c_end:"END:VCALENDAR"};scheduler._lightbox_controls={};
scheduler.formSection=function(a){var b=this.config.lightbox.sections,c=0;for(c;c<b.length&&b[c].name!=a;c++);var d=b[c];scheduler._lightbox||scheduler.getLightbox();a=document.getElementById(d.id);var e=a.nextSibling;a={section:d,header:a,node:e,getValue:function(a){return scheduler.form_blocks[d.type].get_value(e,a||{},d)},setValue:function(a,b){return scheduler.form_blocks[d.type].set_value(e,a,b||{},d)}};return(b=scheduler._lightbox_controls["get_"+d.type+"_control"])?b(a):a};
scheduler._lightbox_controls.get_template_control=function(a){a.control=a.node;return a};scheduler._lightbox_controls.get_select_control=function(a){a.control=a.node.getElementsByTagName("select")[0];return a};scheduler._lightbox_controls.get_textarea_control=function(a){a.control=a.node.getElementsByTagName("textarea")[0];return a};scheduler._lightbox_controls.get_time_control=function(a){a.control=a.node.getElementsByTagName("select");return a};
scheduler.form_blocks={template:{render:function(a){return"<div class='dhx_cal_ltext dhx_cal_template' style='height:"+((a.height||"30")+"px")+";'></div>"},set_value:function(a,b,c,d){a.innerHTML=b||""},get_value:function(a,b,c){return a.innerHTML||""},focus:function(a){}},textarea:{render:function(a){return"<div class='dhx_cal_ltext' style='height:"+((a.height||"130")+"px")+";'><textarea></textarea></div>"},set_value:function(a,b,c){a.firstChild.value=b||""},get_value:function(a,b){return a.firstChild.value},
focus:function(a){scheduler._focus(a.firstChild,!0)}},select:{render:function(a){for(var b="<div class='dhx_cal_ltext' style='height:"+((a.height||"23")+"px")+";'><select style='width:100%;'>",c=0;c<a.options.length;c++)b+="<option value='"+a.options[c].key+"'>"+a.options[c].label+"</option>";return b+"</select></div>"},set_value:function(a,b,c,d){a=a.firstChild;!a._dhx_onchange&&d.onchange&&(a.onchange=d.onchange,a._dhx_onchange=!0);"undefined"==typeof b&&(b=(a.options[0]||{}).value);a.value=b||
""},get_value:function(a,b){return a.firstChild.value},focus:function(a){scheduler._focus(a.firstChild,!0)}},time:{render:function(a){a.time_format||(a.time_format=["%H:%i","%d","%m","%Y"]);a._time_format_order={};var b=a.time_format,c=scheduler.config,d=this.date.date_part(scheduler._currentDate()),e=1440,f=0;scheduler.config.limit_time_select&&(e=60*c.last_hour+1,f=60*c.first_hour,d.setHours(c.first_hour));for(var c="",g=0;g<b.length;g++){var k=b[g];0<g&&(c+=" ");switch(k){case "%Y":a._time_format_order[3]=
g;for(var c=c+"<select>",l=d.getFullYear()-5,k=0;10>k;k++)c+="<option value='"+(l+k)+"'>"+(l+k)+"</option>";c+="</select> ";break;case "%m":a._time_format_order[2]=g;c+="<select>";for(k=0;12>k;k++)c+="<option value='"+k+"'>"+this.locale.date.month_full[k]+"</option>";c+="</select>";break;case "%d":a._time_format_order[1]=g;c+="<select>";for(k=1;32>k;k++)c+="<option value='"+k+"'>"+k+"</option>";c+="</select>";break;case "%H:%i":a._time_format_order[0]=g;c+="<select>";k=f;l=d.getDate();for(a._time_values=
[];k<e;){var h=this.templates.time_picker(d),c=c+("<option value='"+k+"'>"+h+"</option>");a._time_values.push(k);d.setTime(d.valueOf()+6E4*this.config.time_step);k=1440*(d.getDate()!=l?1:0)+60*d.getHours()+d.getMinutes()}c+="</select>"}}return"<div style='height:30px;padding-top:0px;font-size:inherit;' class='dhx_section_time'>"+c+"<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"+c+"</div>"},set_value:function(a,b,c,d){function e(a,b,c){for(var e=d._time_values,f=60*
c.getHours()+c.getMinutes(),h=f,k=!1,B=0;B<e.length;B++){var y=e[B];if(y===f){k=!0;break}y<f&&(h=y)}a[b+g[0]].value=k?f:h;k||h||(a[b+g[0]].selectedIndex=-1);a[b+g[1]].value=c.getDate();a[b+g[2]].value=c.getMonth();a[b+g[3]].value=c.getFullYear()}b=scheduler.config;var f=a.getElementsByTagName("select"),g=d._time_format_order,k,l;if(b.full_day){if(!a._full_day){var h="<label class='dhx_fullday'><input type='checkbox' name='full_day' value='true'> "+scheduler.locale.labels.full_day+"&nbsp;</label></input>";
scheduler.config.wide_form||(h=a.previousSibling.innerHTML+h);a.previousSibling.innerHTML=h;a._full_day=!0}var m=a.previousSibling.getElementsByTagName("input")[0];m.checked=0===scheduler.date.time_part(c.start_date)&&0===scheduler.date.time_part(c.end_date);f[g[0]].disabled=m.checked;f[g[0]+f.length/2].disabled=m.checked;m.onclick=function(){if(m.checked){var b={};scheduler.form_blocks.time.get_value(a,b,d);k=scheduler.date.date_part(b.start_date);l=scheduler.date.date_part(b.end_date);if(+l==+k||
+l>=+k&&(0!==c.end_date.getHours()||0!==c.end_date.getMinutes()))l=scheduler.date.add(l,1,"day")}else l=k=null;f[g[0]].disabled=m.checked;f[g[0]+f.length/2].disabled=m.checked;e(f,0,k||c.start_date);e(f,4,l||c.end_date)}}if(b.auto_end_date&&b.event_duration)for(b=function(){k=new Date(f[g[3]].value,f[g[2]].value,f[g[1]].value,0,f[g[0]].value);l=new Date(k.getTime()+6E4*scheduler.config.event_duration);e(f,4,l)},h=0;4>h;h++)f[h].onchange=b;e(f,0,c.start_date);e(f,4,c.end_date)},get_value:function(a,
b,c){a=a.getElementsByTagName("select");c=c._time_format_order;b.start_date=new Date(a[c[3]].value,a[c[2]].value,a[c[1]].value,0,a[c[0]].value);b.end_date=new Date(a[c[3]+4].value,a[c[2]+4].value,a[c[1]+4].value,0,a[c[0]+4].value);if(!a[c[3]].value||!a[c[3]+4].value)if(c=this.getEvent(this._lightbox_id))b.start_date=c.start_date,b.end_date=c.end_date;b.end_date<=b.start_date&&(b.end_date=scheduler.date.add(b.start_date,scheduler.config.time_step,"minute"));return{start_date:new Date(b.start_date),
end_date:new Date(b.end_date)}},focus:function(a){scheduler._focus(a.getElementsByTagName("select")[0])}}};
scheduler.showCover=function(a){if(a){a.style.display="block";var b=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,c=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,d=window.innerHeight||document.documentElement.clientHeight;a.style.top=b?Math.round(b+Math.max((d-a.offsetHeight)/2,0))+"px":Math.round(Math.max((d-a.offsetHeight)/2,0)+9)+"px";a.style.left=document.documentElement.scrollWidth>document.body.offsetWidth?Math.round(c+(document.body.offsetWidth-
a.offsetWidth)/2)+"px":Math.round((document.body.offsetWidth-a.offsetWidth)/2)+"px"}this.show_cover()};scheduler.showLightbox=function(a){if(a)if(this.callEvent("onBeforeLightbox",[a])){var b=this.getLightbox();this.showCover(b);this._fill_lightbox(a,b);this.callEvent("onLightbox",[a])}else this._new_event&&(this._new_event=null)};
scheduler._fill_lightbox=function(a,b){var c=this.getEvent(a),d=b.getElementsByTagName("span");scheduler.templates.lightbox_header?(d[1].innerHTML="",d[2].innerHTML=scheduler.templates.lightbox_header(c.start_date,c.end_date,c)):(d[1].innerHTML=this.templates.event_header(c.start_date,c.end_date,c),d[2].innerHTML=(this.templates.event_bar_text(c.start_date,c.end_date,c)||"").substr(0,70));for(var d=this.config.lightbox.sections,e=0;e<d.length;e++){var f=d[e],g=document.getElementById(f.id).nextSibling,
k=this.form_blocks[f.type];k.set_value.call(this,g,void 0!==c[f.map_to]?c[f.map_to]:f.default_value,c,f);d[e].focus&&k.focus.call(this,g)}scheduler._lightbox_id=a};scheduler._lightbox_out=function(a){for(var b=this.config.lightbox.sections,c=0;c<b.length;c++){var d=document.getElementById(b[c].id),d=d?d.nextSibling:d,d=this.form_blocks[b[c].type].get_value.call(this,d,a,b[c]);"auto"!=b[c].map_to&&(a[b[c].map_to]=d)}return a};
scheduler._empty_lightbox=function(a){var b=this.getEvent(scheduler._lightbox_id);this.getLightbox();this._lame_copy(b,a);this.setEvent(b.id,b);this._edit_stop_event(b,!0);this.render_view_data()};scheduler.hide_lightbox=function(a){this.hideCover(this.getLightbox());this._lightbox_id=null;this.callEvent("onAfterLightbox",[])};scheduler.hideCover=function(a){a&&(a.style.display="none");this.hide_cover()};
scheduler.hide_cover=function(){this._cover&&this._cover.parentNode.removeChild(this._cover);this._cover=null};scheduler.show_cover=function(){this._cover||(this._cover=document.createElement("DIV"),this._cover.className="dhx_cal_cover",this._cover.style.height=Math.max(void 0!==document.height?document.height:document.body.offsetHeight,document.documentElement?document.documentElement.scrollHeight:0)+"px",document.body.appendChild(this._cover))};
scheduler.save_lightbox=function(){var a=this._lightbox_out({},this._lame_copy(this.getEvent(this._lightbox_id)));if(!this.checkEvent("onEventSave")||this.callEvent("onEventSave",[this._lightbox_id,a,this._new_event]))this._empty_lightbox(a),this.hide_lightbox()};scheduler.startLightbox=function(a,b){this._lightbox_id=a;this._custom_lightbox=!0;this._temp_lightbox=this._lightbox;this._lightbox=b;this.showCover(b)};
scheduler.endLightbox=function(a,b){this._edit_stop_event(scheduler.getEvent(this._lightbox_id),a);a&&scheduler.render_view_data();this.hideCover(b);this._custom_lightbox&&(this._lightbox=this._temp_lightbox,this._custom_lightbox=!1);this._temp_lightbox=this._lightbox_id=null};scheduler.resetLightbox=function(){scheduler._lightbox&&!scheduler._custom_lightbox&&scheduler._lightbox.parentNode.removeChild(scheduler._lightbox);scheduler._lightbox=null};
scheduler.cancel_lightbox=function(){this.callEvent("onEventCancel",[this._lightbox_id,this._new_event]);this.endLightbox(!1);this.hide_lightbox()};
scheduler._init_lightbox_events=function(){this.getLightbox().onclick=function(a){var b=a?a.target:event.srcElement;b.className||(b=b.previousSibling);if(b&&b.className)switch(b.className){case "dhx_save_btn":scheduler.save_lightbox();break;case "dhx_delete_btn":scheduler._dhtmlx_confirm(scheduler.locale.labels.confirm_deleting,scheduler.locale.labels.title_confirm_deleting,function(){scheduler.deleteEvent(scheduler._lightbox_id);scheduler._new_event=null;scheduler.hide_lightbox()});break;case "dhx_cancel_btn":scheduler.cancel_lightbox();
break;default:if(b.getAttribute("dhx_button"))scheduler.callEvent("onLightboxButton",[b.className,b,a]);else{var c,d;-1!=b.className.indexOf("dhx_custom_button")&&(-1!=b.className.indexOf("dhx_custom_button_")?(c=b.parentNode.getAttribute("index"),d=b.parentNode.parentNode):(c=b.getAttribute("index"),d=b.parentNode,b=b.firstChild));c&&(a=scheduler.form_blocks[scheduler.config.lightbox.sections[c].type],a.button_click(c,b,d,d.nextSibling))}}};this.getLightbox().onkeydown=function(a){switch((a||event).keyCode){case scheduler.keys.edit_save:if((a||
event).shiftKey)break;scheduler.save_lightbox();break;case scheduler.keys.edit_cancel:scheduler.cancel_lightbox()}}};scheduler.setLightboxSize=function(){var a=this._lightbox;if(a){var b=a.childNodes[1];b.style.height="0px";b.style.height=b.scrollHeight+"px";a.style.height=b.scrollHeight+scheduler.xy.lightbox_additional_height+"px";b.style.height=b.scrollHeight+"px"}};
scheduler._init_dnd_events=function(){dhtmlxEvent(document.body,"mousemove",scheduler._move_while_dnd);dhtmlxEvent(document.body,"mouseup",scheduler._finish_dnd);scheduler._init_dnd_events=function(){}};
scheduler._move_while_dnd=function(a){if(scheduler._dnd_start_lb){document.dhx_unselectable||(document.body.className+=" dhx_unselectable",document.dhx_unselectable=!0);var b=scheduler.getLightbox();a=a&&a.target?[a.pageX,a.pageY]:[event.clientX,event.clientY];b.style.top=scheduler._lb_start[1]+a[1]-scheduler._dnd_start_lb[1]+"px";b.style.left=scheduler._lb_start[0]+a[0]-scheduler._dnd_start_lb[0]+"px"}};
scheduler._ready_to_dnd=function(a){var b=scheduler.getLightbox();scheduler._lb_start=[parseInt(b.style.left,10),parseInt(b.style.top,10)];scheduler._dnd_start_lb=a&&a.target?[a.pageX,a.pageY]:[event.clientX,event.clientY]};scheduler._finish_dnd=function(){scheduler._lb_start&&(scheduler._lb_start=scheduler._dnd_start_lb=!1,document.body.className=document.body.className.replace(" dhx_unselectable",""),document.dhx_unselectable=!1)};
scheduler.getLightbox=function(){if(!this._lightbox){var a=document.createElement("DIV");a.className="dhx_cal_light";scheduler.config.wide_form&&(a.className+=" dhx_cal_light_wide");scheduler.form_blocks.recurring&&(a.className+=" dhx_cal_light_rec");/msie|MSIE 6/.test(navigator.userAgent)&&(a.className+=" dhx_ie6");a.style.visibility="hidden";for(var b=this._lightbox_template,c=this.config.buttons_left,d=0;d<c.length;d++)b+="<div class='dhx_btn_set dhx_left_btn_set "+c[d]+"_set'><div dhx_button='1' class='"+
c[d]+"'></div><div>"+scheduler.locale.labels[c[d]]+"</div></div>";c=this.config.buttons_right;for(d=0;d<c.length;d++)b+="<div class='dhx_btn_set dhx_right_btn_set "+c[d]+"_set' style='float:right;'><div dhx_button='1' class='"+c[d]+"'></div><div>"+scheduler.locale.labels[c[d]]+"</div></div>";a.innerHTML=b+"</div>";scheduler.config.drag_lightbox&&(a.firstChild.onmousedown=scheduler._ready_to_dnd,a.firstChild.onselectstart=function(){return!1},a.firstChild.style.cursor="pointer",scheduler._init_dnd_events());
document.body.insertBefore(a,document.body.firstChild);this._lightbox=a;c=this.config.lightbox.sections;b="";for(d=0;d<c.length;d++){var e=this.form_blocks[c[d].type];if(e){c[d].id="area_"+this.uid();var f="";c[d].button&&(f="<div class='dhx_custom_button' index='"+d+"'><div class='dhx_custom_button_"+c[d].button+"'></div><div>"+this.locale.labels["button_"+c[d].button]+"</div></div>");this.config.wide_form&&(b+="<div class='dhx_wrap_section'>");var g=this.locale.labels["section_"+c[d].name];"string"!==
typeof g&&(g=c[d].name);b+="<div id='"+c[d].id+"' class='dhx_cal_lsection'>"+f+g+"</div>"+e.render.call(this,c[d]);b+="</div>"}}c=a.getElementsByTagName("div");for(d=0;d<c.length;d++)if(e=c[d],"dhx_cal_larea"==e.className){e.innerHTML=b;break}this.setLightboxSize();this._init_lightbox_events(this);a.style.display="none";a.style.visibility="visible"}return this._lightbox};scheduler.attachEvent("onEventIdChange",function(a,b){this._lightbox_id==a&&(this._lightbox_id=b)});
scheduler._lightbox_template="<div class='dhx_cal_ltitle'><span class='dhx_mark'>&nbsp;</span><span class='dhx_time'></span><span class='dhx_title'></span></div><div class='dhx_cal_larea'></div>";
scheduler._init_touch_events=function(){"force"!=this.config.touch&&(this.config.touch=this.config.touch&&(-1!=navigator.userAgent.indexOf("Mobile")||-1!=navigator.userAgent.indexOf("iPad")||-1!=navigator.userAgent.indexOf("Android")||-1!=navigator.userAgent.indexOf("Touch")));this.config.touch&&(this.xy.scroll_width=0,window.navigator.msPointerEnabled?(this._touch_events(["MSPointerMove","MSPointerDown","MSPointerUp"],function(a){return a.pointerType==a.MSPOINTER_TYPE_MOUSE?null:a},function(a){return!a||
a.pointerType==a.MSPOINTER_TYPE_MOUSE}),this._obj.ondblclick=function(){}):this._touch_events(["touchmove","touchstart","touchend"],function(a){return a.touches&&1<a.touches.length?null:a.touches[0]?{target:a.target,pageX:a.touches[0].pageX,pageY:a.touches[0].pageY}:a},function(){return!1}))};
scheduler._touch_events=function(a,b,c){function d(a,b,c){dhtmlxEvent(a,b,function(a){return scheduler._is_lightbox_open()?!0:c(a)})}function e(a,b,c){if(a&&b){var d=Math.abs(a.pageY-b.pageY),e=Math.abs(a.pageX-b.pageX);e>c&&(!d||3<e/d)&&(a.pageX>b.pageX?scheduler._click.dhx_cal_next_button():scheduler._click.dhx_cal_prev_button())}}function f(a){var b=scheduler.getState().drag_mode,c=scheduler.matrix?scheduler.matrix[scheduler._mode]:!1,d=scheduler.render_view_data;"create"==b&&c&&(scheduler.render_view_data=
function(){for(var a=scheduler.getState().drag_id,a=scheduler.getEvent(a),b=c.y_property,d=scheduler.getEvents(a.start_date,a.end_date),e=0;e<d.length;e++)d[e][b]!=a[b]&&(d.splice(e,1),e--);a._sorder=d.length-1;a._count=d.length;this.render_data([a],scheduler.getState().mode)});scheduler._on_mouse_move(a);"create"==b&&c&&(scheduler.render_view_data=d)}function g(a){scheduler._hide_global_tip();p&&(scheduler._on_mouse_up(b(a||event)),scheduler._temp_touch_block=!1);scheduler._drag_id=null;scheduler._drag_mode=
null;scheduler._drag_pos=null;clearTimeout(m);p=q=!1;n=!0}var k=-1!=navigator.userAgent.indexOf("Android")&&-1!=navigator.userAgent.indexOf("WebKit"),l,h,m,p,n,q,v=0;d(document.body,a[0],function(a){if(!c(a)){if(p)return f(b(a)),scheduler._update_global_tip(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,!1;h&&k&&e(h,b(a),0);h=b(a);if(q)if(!h)n=!0;else if(l.target!=h.target||5<Math.abs(l.pageX-h.pageX)||5<Math.abs(l.pageY-h.pageY))n=!0,clearTimeout(m)}});d(this._els.dhx_cal_data[0],"scroll",
g);d(this._els.dhx_cal_data[0],"touchcancel",g);d(this._els.dhx_cal_data[0],"contextmenu",function(a){if(q)return a&&a.preventDefault&&a.preventDefault(),(a||event).cancelBubble=!0,!1});d(this._els.dhx_cal_data[0],a[1],function(a){if(!c(a)){var d;p=n=!1;q=!0;scheduler._temp_touch_block=!0;if(d=h=b(a)){var e=new Date;if(!n&&!p&&250>e-v)return scheduler._click.dhx_cal_data(d),window.setTimeout(function(){scheduler._on_dbl_click(d)},50),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,scheduler._block_next_stop=
!0,!1;v=e;n||p||!scheduler.config.touch_drag||(m=setTimeout(function(){p=!0;var a=l.target;a&&a.className&&-1!=a.className.indexOf("dhx_body")&&(a=a.previousSibling);scheduler._on_mouse_down(l,a);if(scheduler._drag_mode&&"create"!=scheduler._drag_mode){var b=-1;scheduler.for_rendered(scheduler._drag_id,function(a,c){b=a.getBoundingClientRect().top;a.style.display="none";scheduler._rendered.splice(c,1)});0<=b&&(a=scheduler.config.time_step,scheduler._move_pos_shift=a*Math.round(60*(d.pageY-b)/(scheduler.config.hour_size_px*
a)))}scheduler.config.touch_tip&&scheduler._show_global_tip();scheduler._on_mouse_move(l)},scheduler.config.touch_drag),l=d)}else n=!0}});d(this._els.dhx_cal_data[0],a[2],function(a){if(!c(a)&&(p||e(l,h,200),p&&(scheduler._ignore_next_click=!0),g(a),scheduler._block_next_stop))return scheduler._block_next_stop=!1,a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,!1});dhtmlxEvent(document.body,a[2],g)};
scheduler._show_global_tip=function(){scheduler._hide_global_tip();var a=scheduler._global_tip=document.createElement("DIV");a.className="dhx_global_tip";scheduler._update_global_tip(1);document.body.appendChild(a)};
scheduler._update_global_tip=function(a){var b=scheduler._global_tip;if(b){var c="";scheduler._drag_id&&!a&&(a=scheduler.getEvent(scheduler._drag_id))&&(c="<div>"+(a._timed?scheduler.templates.event_header(a.start_date,a.end_date,a):scheduler.templates.day_date(a.start_date,a.end_date,a))+"</div>");b.innerHTML="create"==scheduler._drag_mode||"new-size"==scheduler._drag_mode?(scheduler.locale.drag_to_create||"Drag to create")+c:(scheduler.locale.drag_to_move||"Drag to move")+c}};
scheduler._hide_global_tip=function(){var a=scheduler._global_tip;a&&a.parentNode&&(a.parentNode.removeChild(a),scheduler._global_tip=0)};
scheduler._dp_init=function(a){a._methods=["_set_event_text_style","","changeEventId","_dp_hook_delete"];this._dp_hook_delete=function(a){return this.deleteEvent(a,!0)};this.attachEvent("onEventAdded",function(b){!this._loading&&this._validId(b)&&a.setUpdated(b,!0,"inserted")});this.attachEvent("onConfirmedBeforeEventDelete",function(b){if(this._validId(b)){var c=a.getState(b);if("inserted"==c||this._new_event)return a.setUpdated(b,!1),!0;if("deleted"==c)return!1;if("true_deleted"==c)return!0;a.setUpdated(b,
!0,"deleted");return!1}});this.attachEvent("onEventChanged",function(b){!this._loading&&this._validId(b)&&a.setUpdated(b,!0,"updated")});a._getRowData=function(a,c){var d=this.obj.getEvent(a),e={},f;for(f in d)0!==f.indexOf("_")&&(e[f]=d[f]&&d[f].getUTCFullYear?this.obj.templates.xml_format(d[f]):d[f]);return e};a._clearUpdateFlag=function(){};a.attachEvent("insertCallback",scheduler._update_callback);a.attachEvent("updateCallback",scheduler._update_callback);a.attachEvent("deleteCallback",function(a,
c){this.obj.setUserData(c,this.action_param,"true_deleted");this.obj.deleteEvent(c)})};scheduler._validId=function(a){return!0};scheduler.setUserData=function(a,b,c){a?this.getEvent(a)[b]=c:this._userdata[b]=c};scheduler.getUserData=function(a,b){return a?this.getEvent(a)[b]:this._userdata[b]};scheduler._set_event_text_style=function(a,b){this.for_rendered(a,function(a){a.style.cssText+=";"+b});var c=this.getEvent(a);c._text_style=b;this.event_updated(c)};
scheduler._update_callback=function(a,b){var c=scheduler._xmlNodeToJSON(a.firstChild);c.text=c.text||c._tagvalue;c.start_date=scheduler.templates.xml_date(c.start_date);c.end_date=scheduler.templates.xml_date(c.end_date);scheduler.addEvent(c)};scheduler._skin_settings={fix_tab_position:[1,0],use_select_menu_space:[1,0],wide_form:[1,0],hour_size_px:[44,42],displayed_event_color:["#ff4a4a","ffc5ab"],displayed_event_text_color:["#ffef80","7e2727"]};
scheduler._skin_xy={lightbox_additional_height:[90,50],nav_height:[59,22],bar_height:[24,20]};scheduler._configure=function(a,b,c){for(var d in b)"undefined"==typeof a[d]&&(a[d]=b[d][c])};
scheduler._skin_init=function(){if(!scheduler.skin)for(var a=document.getElementsByTagName("link"),b=0;b<a.length;b++){var c=a[b].href.match("dhtmlxscheduler_([a-z]+).css");if(c){scheduler.skin=c[1];break}}a=0;!scheduler.skin||"classic"!==scheduler.skin&&"glossy"!==scheduler.skin||(a=1);this._configure(scheduler.config,scheduler._skin_settings,a);this._configure(scheduler.xy,scheduler._skin_xy,a);"flat"===scheduler.skin&&(scheduler.xy.scale_height=35,scheduler.templates.hour_scale=function(a){var b=
a.getMinutes(),b=10>b?"0"+b:b;return"<span class='dhx_scale_h'>"+a.getHours()+"</span><span class='dhx_scale_m'>&nbsp;"+b+"</span>"});if(!a){if(a=scheduler.config.minicalendar)a.padding=14;scheduler.templates.event_bar_date=function(a,b,c){return" <b>"+scheduler.templates.event_date(a)+"</b> "};scheduler.attachEvent("onTemplatesReady",function(){var a=scheduler.date.date_to_str("%d");scheduler.templates._old_month_day||(scheduler.templates._old_month_day=scheduler.templates.month_day);var b=scheduler.templates._old_month_day;
scheduler.templates.month_day=function(c){if("month"==this._mode){var f=a(c);1==c.getDate()&&(f=scheduler.locale.date.month_full[c.getMonth()]+" "+f);+c==+scheduler.date.date_part(new Date)&&(f=scheduler.locale.labels.dhx_cal_today_button+" "+f);return f}return b.call(this,c)};if(scheduler.config.fix_tab_position){for(var c=scheduler._els.dhx_cal_navline[0].getElementsByTagName("div"),g=null,k=211,l=0;l<c.length;l++){var h=c[l],m=h.getAttribute("name");if(m)switch(h.style.right="auto",m){case "day_tab":h.style.left=
"14px";h.className+=" dhx_cal_tab_first";break;case "week_tab":h.style.left="75px";break;case "month_tab":h.style.left="136px";h.className+=" dhx_cal_tab_last";break;default:h.style.left=k+"px",h.className+=" dhx_cal_tab_standalone",k=k+14+h.offsetWidth}else 0===(h.className||"").indexOf("dhx_minical_icon")&&h.parentNode==scheduler._els.dhx_cal_navline[0]&&(g=h)}g&&(g.style.left=k+"px")}});scheduler._skin_init=function(){}}};
window.jQuery&&function(a){var b=[];a.fn.dhx_scheduler=function(c){if("string"===typeof c){if(b[c])return b[c].apply(this,[]);a.error("Method "+c+" does not exist on jQuery.dhx_scheduler")}else{var d=[];this.each(function(){if(this&&this.getAttribute&&!this.getAttribute("dhxscheduler")){for(var a in c)"data"!=a&&(scheduler.config[a]=c[a]);this.getElementsByTagName("div").length||(this.innerHTML='<div class="dhx_cal_navline"><div class="dhx_cal_prev_button">&nbsp;</div><div class="dhx_cal_next_button">&nbsp;</div><div class="dhx_cal_today_button"></div><div class="dhx_cal_date"></div><div class="dhx_cal_tab" name="day_tab" style="right:204px;"></div><div class="dhx_cal_tab" name="week_tab" style="right:140px;"></div><div class="dhx_cal_tab" name="month_tab" style="right:76px;"></div></div><div class="dhx_cal_header"></div><div class="dhx_cal_data"></div>',
this.className+=" dhx_cal_container");scheduler.init(this,scheduler.config.date,scheduler.config.mode);c.data&&scheduler.parse(c.data);d.push(scheduler)}});return 1===d.length?d[0]:d}}}(jQuery);
(function(){function a(a,b,c){b&&(a._date=b);c&&(a._mode=c)}var b=scheduler.setCurrentView,c=scheduler.updateView,d=null,e=null,f=function(b,f){var g=this;window.clearTimeout(e);window.clearTimeout(d);a(this,b,f);e=setTimeout(function(){g.callEvent("onBeforeViewChange",[g._mode,g._date,f||g._mode,b||g._date])&&(c.call(g,b,f),g.callEvent("onViewChange",[g._mode,g._date]),window.clearTimeout(d),e=0)},scheduler.config.delay_render)},g=function(b,f){var g=this,m=arguments;a(this,b,f);window.clearTimeout(d);
d=setTimeout(function(){e||c.apply(g,m)},scheduler.config.delay_render)};scheduler.attachEvent("onSchedulerReady",function(){scheduler.config.delay_render?(scheduler.setCurrentView=f,scheduler.updateView=g):(scheduler.setCurrentView=b,scheduler.updateView=c)})})();scheduler.locale={date:{month_full:"    Ma     O  ".split(" "),month_short:"  Ma A Ma   A    ".split(" "),day_full:"      ".split(" "),day_short:"      ".split(" ")},labels:{dhx_cal_today_button:"",day_tab:"",week_tab:"",month_tab:"",timeline_tab:"",new_event:" ",icon_save:"",icon_cancel:"",
icon_details:"",icon_edit:"",icon_delete:"",confirm_closing:"  , ?",confirm_deleting:"   , ?",section_description:"",section_time:" ",full_day:" ",confirm_recurring:"      ?",section_recurring:"",button_recurring:"",button_recurring_open:"",button_edit_series:" ",button_edit_occurrence:" ",
agenda_tab:"",date:"",description:"",year_tab:"",week_agenda_tab:"",grid_tab:"",drag_to_create:"  ",drag_to_move:"  ",message_ok:"OK",message_cancel:"Cancel"}};scheduler.templates.calendar_month=scheduler.date.date_to_str("%F %Y");scheduler.templates.calendar_scale_date=scheduler.date.date_to_str("%D");scheduler.templates.calendar_date=scheduler.date.date_to_str("%d");scheduler.config.minicalendar={mark_events:!0};scheduler._synced_minicalendars=[];
scheduler.renderCalendar=function(a,b,c){var d=null,e=a.date||scheduler._currentDate();"string"==typeof e&&(e=this.templates.api_date(e));if(b)d=this._render_calendar(b.parentNode,e,a,b),scheduler.unmarkCalendar(d);else{b=a.container;var f=a.position;"string"==typeof b&&(b=document.getElementById(b));"string"==typeof f&&(f=document.getElementById(f));if(f&&"undefined"==typeof f.left)var g=getOffset(f),f={top:g.top+f.offsetHeight,left:g.left};b||(b=scheduler._get_def_cont(f));d=this._render_calendar(b,
e,a);d.onclick=function(a){a=a||event;a=a.target||a.srcElement;if(-1!=a.className.indexOf("dhx_month_head")){var b=a.parentNode.className;-1==b.indexOf("dhx_after")&&-1==b.indexOf("dhx_before")&&(b=scheduler.templates.xml_date(this.getAttribute("date")),b.setDate(parseInt(a.innerHTML,10)),scheduler.unmarkCalendar(this),scheduler.markCalendar(this,b,"dhx_calendar_click"),this._last_date=b,this.conf.handler&&this.conf.handler.call(scheduler,b,this))}}}if(scheduler.config.minicalendar.mark_events){e=
scheduler.date.month_start(e);b=scheduler.date.add(e,1,"month");for(var f=this.getEvents(e,b),g=this["filter_"+this._mode],k=0;k<f.length;k++){var l=f[k];if(!g||g(l.id,l)){var h=l.start_date;h.valueOf()<e.valueOf()&&(h=e);for(h=scheduler.date.date_part(new Date(h.valueOf()));h<l.end_date&&!(this.markCalendar(d,h,"dhx_year_event"),h=this.date.add(h,1,"day"),h.valueOf()>=b.valueOf()););}}}this._markCalendarCurrentDate(d);d.conf=a;a.sync&&!c&&this._synced_minicalendars.push(d);d.conf._on_xle_handler||
(d.conf._on_xle_handler=scheduler.attachEvent("onXLE",function(){scheduler.updateCalendar(d,d.conf.date)}));return d};scheduler._get_def_cont=function(a){this._def_count||(this._def_count=document.createElement("DIV"),this._def_count.className="dhx_minical_popup",this._def_count.onclick=function(a){(a||event).cancelBubble=!0},document.body.appendChild(this._def_count));this._def_count.style.left=a.left+"px";this._def_count.style.top=a.top+"px";this._def_count._created=new Date;return this._def_count};
scheduler._locateCalendar=function(a,b){"string"==typeof b&&(b=scheduler.templates.api_date(b));if(+b>+a._max_date||+b<+a._min_date)return null;for(var c=a.childNodes[2].childNodes[0],d=0,e=new Date(a._min_date);+this.date.add(e,1,"week")<=+b;)e=this.date.add(e,1,"week"),d++;e=scheduler.config.start_on_monday;e=(b.getDay()||(e?7:0))-(e?1:0);return c.rows[d].cells[e].firstChild};scheduler.markCalendar=function(a,b,c){if(a=this._locateCalendar(a,b))a.className+=" "+c};
scheduler.unmarkCalendar=function(a,b,c){b=b||a._last_date;c=c||"dhx_calendar_click";b&&(a=this._locateCalendar(a,b))&&(a.className=(a.className||"").replace(RegExp(c,"g")))};scheduler._week_template=function(a){a=a||250;for(var b=0,c=document.createElement("div"),d=this.date.week_start(scheduler._currentDate()),e=0;7>e;e++)this._cols[e]=Math.floor(a/(7-e)),this._render_x_header(e,b,d,c),d=this.date.add(d,1,"day"),a-=this._cols[e],b+=this._cols[e];c.lastChild.className+=" dhx_scale_bar_last";return c};
scheduler.updateCalendar=function(a,b){a.conf.date=b;this.renderCalendar(a.conf,a,!0)};scheduler._mini_cal_arrows=["&nbsp","&nbsp"];
scheduler._render_calendar=function(a,b,c,d){var e=scheduler.templates,f=this._cols;this._cols=[];var g=this._mode;this._mode="calendar";var k=this._colsS;this._colsS={height:0};var l=new Date(this._min_date),h=new Date(this._max_date),m=new Date(scheduler._date),p=e.month_day,n=this._ignores_detected;this._ignores_detected=0;e.month_day=e.calendar_date;b=this.date.month_start(b);var q=this._week_template(a.offsetWidth-1-this.config.minicalendar.padding),v;d?v=d:(v=document.createElement("DIV"),v.className=
"dhx_cal_container dhx_mini_calendar");v.setAttribute("date",this.templates.xml_format(b));v.innerHTML="<div class='dhx_year_month'></div><div class='dhx_year_week'>"+q.innerHTML+"</div><div class='dhx_year_body'></div>";v.childNodes[0].innerHTML=this.templates.calendar_month(b);if(c.navigation)for(var u=function(a,b){var c=scheduler.date.add(a._date,b,"month");scheduler.updateCalendar(a,c);scheduler._date.getMonth()==a._date.getMonth()&&scheduler._date.getFullYear()==a._date.getFullYear()&&scheduler._markCalendarCurrentDate(a)},
q=["dhx_cal_prev_button","dhx_cal_next_button"],x=["left:1px;top:2px;position:absolute;","left:auto; right:1px;top:2px;position:absolute;"],z=[-1,1],B=function(a){return function(){if(c.sync)for(var b=scheduler._synced_minicalendars,d=0;d<b.length;d++)u(b[d],a);else u(v,a)}},y=0;2>y;y++){var C=document.createElement("DIV");C.className=q[y];C.style.cssText=x[y];C.innerHTML=this._mini_cal_arrows[y];v.firstChild.appendChild(C);C.onclick=B(z[y])}v._date=new Date(b);v.week_start=(b.getDay()-(this.config.start_on_monday?
1:0)+7)%7;q=v._min_date=this.date.week_start(b);v._max_date=this.date.add(v._min_date,6,"week");this._reset_month_scale(v.childNodes[2],b,q);b=v.childNodes[2].firstChild.rows;for(q=b.length;6>q;q++)for(x=b[b.length-1],b[0].parentNode.appendChild(x.cloneNode(!0)),x=parseInt(x.childNodes[x.childNodes.length-1].childNodes[0].innerHTML),x=10>x?x:0,z=0;z<b[q].childNodes.length;z++)b[q].childNodes[z].className="dhx_after",b[q].childNodes[z].childNodes[0].innerHTML=scheduler.date.to_fixed(++x);d||a.appendChild(v);
v.childNodes[1].style.height=v.childNodes[1].childNodes[0].offsetHeight-1+"px";this._cols=f;this._mode=g;this._colsS=k;this._min_date=l;this._max_date=h;scheduler._date=m;e.month_day=p;this._ignores_detected=n;return v};
scheduler.destroyCalendar=function(a,b){!a&&this._def_count&&this._def_count.firstChild&&(b||500<(new Date).valueOf()-this._def_count._created.valueOf())&&(a=this._def_count.firstChild);a&&(a.onclick=null,a.innerHTML="",a.parentNode&&a.parentNode.removeChild(a),this._def_count&&(this._def_count.style.top="-1000px"),a.conf&&a.conf._on_xle_handler&&scheduler.detachEvent(a.conf._on_xle_handler))};
scheduler.isCalendarVisible=function(){return this._def_count&&0<parseInt(this._def_count.style.top,10)?this._def_count:!1};scheduler._attach_minical_events=function(){dhtmlxEvent(document.body,"click",function(){scheduler.destroyCalendar()});scheduler._attach_minical_events=function(){}};scheduler.attachEvent("onTemplatesReady",function(){scheduler._attach_minical_events()});scheduler.templates.calendar_time=scheduler.date.date_to_str("%d-%m-%Y");
scheduler.form_blocks.calendar_time={render:function(){var a="<input class='dhx_readonly' type='text' readonly='true'>",b=scheduler.config,c=this.date.date_part(scheduler._currentDate()),d=1440,e=0;b.limit_time_select&&(e=60*b.first_hour,d=60*b.last_hour+1);c.setHours(e/60);a+=" <select>";for(b=e;b<d;b+=1*this.config.time_step)e=this.templates.time_picker(c),a+="<option value='"+b+"'>"+e+"</option>",c=this.date.add(c,this.config.time_step,"minute");a+="</select>";return"<div style='height:30px;padding-top:0; font-size:inherit;' class='dhx_section_time'>"+
a+"<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"+a+"</div>"},set_value:function(a,b,c){function d(a,b,c){l(a,b,c);a.value=scheduler.templates.calendar_time(b);a._date=scheduler.date.date_part(new Date(b))}var e=a.getElementsByTagName("input"),f=a.getElementsByTagName("select"),g,k,l=function(a,b,c){a.onclick=function(){scheduler.destroyCalendar(null,!0);scheduler.renderCalendar({position:a,date:new Date(this._date),navigation:!0,handler:function(b){a.value=scheduler.templates.calendar_time(b);
a._date=new Date(b);scheduler.destroyCalendar();scheduler.config.event_duration&&scheduler.config.auto_end_date&&0===c&&m()}})}};if(scheduler.config.full_day){a._full_day||(b="<label class='dhx_fullday'><input type='checkbox' name='full_day' value='true'> "+scheduler.locale.labels.full_day+"&nbsp;</label></input>",scheduler.config.wide_form||(b=a.previousSibling.innerHTML+b),a.previousSibling.innerHTML=b,a._full_day=!0);var h=a.previousSibling.getElementsByTagName("input")[0];b=0===scheduler.date.time_part(c.start_date)&&
0===scheduler.date.time_part(c.end_date);h.checked=b;f[0].disabled=h.checked;f[1].disabled=h.checked;h.onclick=function(){if(!0===h.checked){var b={};scheduler.form_blocks.calendar_time.get_value(a,b);g=scheduler.date.date_part(b.start_date);k=scheduler.date.date_part(b.end_date);if(+k==+g||+k>=+g&&(0!==c.end_date.getHours()||0!==c.end_date.getMinutes()))k=scheduler.date.add(k,1,"day")}var b=g||c.start_date,l=k||c.end_date;d(e[0],b);d(e[1],l);f[0].value=60*b.getHours()+b.getMinutes();f[1].value=60*
l.getHours()+l.getMinutes();f[0].disabled=h.checked;f[1].disabled=h.checked}}if(scheduler.config.event_duration&&scheduler.config.auto_end_date){var m=function(){g=scheduler.date.add(e[0]._date,f[0].value,"minute");k=new Date(g.getTime()+6E4*scheduler.config.event_duration);e[1].value=scheduler.templates.calendar_time(k);e[1]._date=scheduler.date.date_part(new Date(k));f[1].value=60*k.getHours()+k.getMinutes()};f[0].onchange=m}d(e[0],c.start_date,0);d(e[1],c.end_date,1);l=function(){};f[0].value=
60*c.start_date.getHours()+c.start_date.getMinutes();f[1].value=60*c.end_date.getHours()+c.end_date.getMinutes()},get_value:function(a,b){var c=a.getElementsByTagName("input"),d=a.getElementsByTagName("select");b.start_date=scheduler.date.add(c[0]._date,d[0].value,"minute");b.end_date=scheduler.date.add(c[1]._date,d[1].value,"minute");b.end_date<=b.start_date&&(b.end_date=scheduler.date.add(b.start_date,scheduler.config.time_step,"minute"));return{start_date:new Date(b.start_date),end_date:new Date(b.end_date)}},
focus:function(a){}};scheduler.linkCalendar=function(a,b){var c=function(){var c=new Date(scheduler._date.valueOf());b&&(c=b(c));c.setDate(1);scheduler.updateCalendar(a,c);return!0};scheduler.attachEvent("onViewChange",c);scheduler.attachEvent("onXLE",c);scheduler.attachEvent("onEventAdded",c);scheduler.attachEvent("onEventChanged",c);scheduler.attachEvent("onAfterEventDelete",c);c()};
scheduler._markCalendarCurrentDate=function(a){var b=scheduler._date,c=scheduler._mode,d=scheduler.date.month_start(new Date(a._date)),e=scheduler.date.add(d,1,"month");if("day"==c||this._props&&this._props[c])d.valueOf()<=b.valueOf()&&e>b&&scheduler.markCalendar(a,b,"dhx_calendar_click");else if("week"==c)for(b=scheduler.date.week_start(new Date(b.valueOf())),c=0;7>c;c++)d.valueOf()<=b.valueOf()&&e>b&&scheduler.markCalendar(a,b,"dhx_calendar_click"),b=scheduler.date.add(b,1,"day")};
scheduler.attachEvent("onEventCancel",function(){scheduler.destroyCalendar(null,!0)});scheduler._temp_matrix_scope=function(){function a(a,b,c){var d=0,e=c._step,f=c.round_position,g=0;a=b?a.end_date:a.start_date;a.valueOf()>scheduler._max_date.valueOf()&&(a=scheduler._max_date);var h=a-scheduler._min_date_timeline;if(0<h){var k=scheduler._get_date_index(c,a);scheduler._ignores[k]&&(f=!0);for(var l=0;k>l;l++)d+=scheduler._cols[l];l=scheduler.date.add(scheduler._min_date_timeline,scheduler.matrix[scheduler._mode].x_step*k,scheduler.matrix[scheduler._mode].x_unit);f?+a>+l&&b&&(g=scheduler._cols[k]):
(h=a-l,c.first_hour||c.last_hour?(h-=c._start_correction,0>h&&(h=0),g=Math.round(h/e),g>scheduler._cols[k]&&(g=scheduler._cols[k])):g=Math.round(h/e))}return d+(b?0===h||f?g-14:g-12:g+1)}function b(a,b){var c=scheduler._get_date_index(this,a),d=this._trace_x[c];return b&&+a!=+this._trace_x[c]&&(d=this._trace_x[c+1]?this._trace_x[c+1]:scheduler.date.add(this._trace_x[c],this.x_step,this.x_unit)),new Date(d)}function c(a){var c="";if(a&&"cell"!=this.render){a.sort(this.sort||function(a,b){return a.start_date.valueOf()==
b.start_date.valueOf()?a.id>b.id?1:-1:a.start_date>b.start_date?1:-1});for(var d=[],e=a.length,f=0;e>f;f++){var g=a[f];g._inner=!1;var h=this.round_position?b.apply(this,[g.start_date,!1]):g.start_date;for(this.round_position?b.apply(this,[g.end_date,!0]):g.end_date;d.length&&d[d.length-1].end_date.valueOf()<=h.valueOf();)d.splice(d.length-1,1);for(var k=!1,l=0;l<d.length;l++){var m=d[l];if(m.end_date.valueOf()<=h.valueOf()){k=!0;g._sorder=m._sorder;d.splice(l,1);g._inner=!0;break}}if(d.length&&(d[d.length-
1]._inner=!0),!k)if(d.length)if(d.length<=d[d.length-1]._sorder){if(d[d.length-1]._sorder)for(h=0;h<d.length;h++){k=!1;for(l=0;l<d.length;l++)if(d[l]._sorder==h){k=!0;break}if(!k){g._sorder=h;break}}else g._sorder=0;g._inner=!0}else{h=d[0]._sorder;for(k=1;k<d.length;k++)d[k]._sorder>h&&(h=d[k]._sorder);g._sorder=h+1;g._inner=!1}else g._sorder=0;d.push(g);d.length>(d.max_count||0)?(d.max_count=d.length,g._count=d.length):g._count=g._count?g._count:1}for(f=0;f<a.length;f++)a[f]._count=d.max_count;for(d=
0;e>d;d++)c+=scheduler.render_timeline_event.call(this,a[d],!1)}return c}function d(a){var b=scheduler._min_date,c=scheduler._max_date;scheduler._process_ignores(b,this.x_size,this.x_unit,this.x_step,a);for(var d=(this.x_size+(a?scheduler._ignores_detected:0),0),e=0;+c>+b;)if(this._trace_x[e]=new Date(b),b=scheduler.date.add(b,this.x_step,this.x_unit),scheduler.date[this.x_unit+"_start"]&&(b=scheduler.date[this.x_unit+"_start"](b)),scheduler._ignores[e]||d++,e++,a)if(d<this.x_size&&!(+c>+b))c=scheduler.date["add_"+
this.name+"_private"](c,(this.x_length||this.x_size)*this.x_step);else if(d>=this.x_size){scheduler._max_date=b;break}return{total:e,displayed:d}}function e(a){var b=scheduler.xy.scale_height,c=this._header_resized||scheduler.xy.scale_height;scheduler._cols=[];scheduler._colsS={height:0};this._trace_x=[];var e=scheduler._x-this.dx-scheduler.xy.scroll_width,g=[this.dx];scheduler._els.dhx_cal_header[0].style.width=g[0]+e+"px";for(var h=scheduler._min_date_timeline=scheduler._min_date,k=d.call(this,
scheduler.config.preserve_scale_length),h=k.displayed,k=k.total,m=0;k>m;m++)scheduler._ignores[m]?(scheduler._cols[m]=0,h++):scheduler._cols[m]=Math.floor(e/(h-m)),e-=scheduler._cols[m],g[m+1]=g[m]+scheduler._cols[m];if(a.innerHTML="<div></div>",this.second_scale){for(var m=this.second_scale.x_unit,e=[this._trace_x[0]],h=[],k=[this.dx,this.dx],n=0,r=0;r<this._trace_x.length;r++){var w=this._trace_x[r];f(m,w,e[n])&&(++n,e[n]=w,k[n+1]=k[n]);w=n+1;h[n]=scheduler._cols[r]+(h[n]||0);k[w]+=scheduler._cols[r]}a.innerHTML=
"<div></div><div></div>";m=a.firstChild;m.style.height=c+"px";a.lastChild.style.position="relative";for(n=0;n<e.length;n++){var r=e[n],w=scheduler.templates[this.name+"_second_scalex_class"](r),p=document.createElement("DIV");p.className="dhx_scale_bar dhx_second_scale_bar"+(w?" "+w:"");scheduler.set_xy(p,h[n]-1,c-3,k[n],0);p.innerHTML=scheduler.templates[this.name+"_second_scale_date"](r);m.appendChild(p)}}scheduler.xy.scale_height=c;a=a.lastChild;for(c=0;c<this._trace_x.length;c++)scheduler._ignores[c]||
(h=this._trace_x[c],scheduler._render_x_header(c,g[c],h,a),(e=scheduler.templates[this.name+"_scalex_class"](h))&&(a.lastChild.className+=" "+e));scheduler.xy.scale_height=b;var t=this._trace_x;a.onclick=function(a){var b=l(a);b&&scheduler.callEvent("onXScaleClick",[b.x,t[b.x],a||event])};a.ondblclick=function(a){var b=l(a);b&&scheduler.callEvent("onXScaleDblClick",[b.x,t[b.x],a||event])}}function f(a,b,c){switch(a){case "hour":return b.getHours()!=c.getHours()||f("day",b,c);case "day":return!(b.getDate()==
c.getDate()&&b.getMonth()==c.getMonth()&&b.getFullYear()==c.getFullYear());case "week":return!(scheduler.date.getISOWeek(b)==scheduler.date.getISOWeek(c)&&b.getFullYear()==c.getFullYear());case "month":return!(b.getMonth()==c.getMonth()&&b.getFullYear()==c.getFullYear());case "year":return b.getFullYear()!=c.getFullYear();default:return!1}}function g(){scheduler._tooltip&&(scheduler._tooltip.style.display="none",scheduler._tooltip.date="")}function k(a,b,c){if("cell"==a.render){var d=b.x+"_"+b.y,
e=a._matrix[b.y][b.x];if(!e)return g();if(e.sort(function(a,b){return a.start_date>b.start_date?1:-1}),scheduler._tooltip){if(scheduler._tooltip.date==d)return;scheduler._tooltip.innerHTML=""}else{var f=scheduler._tooltip=document.createElement("DIV");f.className="dhx_year_tooltip";document.body.appendChild(f);f.onclick=scheduler._click.dhx_cal_data}for(var f="",h=0;h<e.length;h++)f+="<div class='dhx_tooltip_line' event_id='"+e[h].id+"' style='"+(e[h].color?"background-color:"+e[h].color+";":"")+
(e[h].textColor?"color:"+e[h].textColor+";":"")+"'>",f+="<div class='dhx_tooltip_date'>"+(e[h]._timed?scheduler.templates.event_date(e[h].start_date):"")+"</div>",f+="<div class='dhx_event_icon icon_details'>&nbsp;</div>",f+=scheduler.templates[a.name+"_tooltip"](e[h].start_date,e[h].end_date,e[h])+"</div>";scheduler._tooltip.style.display="";scheduler._tooltip.style.top="0px";scheduler._tooltip.style.left=0>document.body.offsetWidth-c.left-scheduler._tooltip.offsetWidth?c.left-scheduler._tooltip.offsetWidth+
"px":c.left+b.src.offsetWidth+"px";scheduler._tooltip.date=d;scheduler._tooltip.innerHTML=f;scheduler._tooltip.style.top=0>document.body.offsetHeight-c.top-scheduler._tooltip.offsetHeight?c.top-scheduler._tooltip.offsetHeight+b.src.offsetHeight+"px":c.top+"px"}}function l(a){a=a||event;for(a=a.target?a.target:a.srcElement;a&&"DIV"!=a.tagName;)a=a.parentNode;if(a&&"DIV"==a.tagName&&"dhx_scale_bar"==a.className.split(" ")[0]){var b;a:{b=a.parentNode.childNodes;for(var c=0;c<b.length;c++)if(b[c]==a){b=
c;break a}b=-1}return{x:b,y:-1,src:a,scale:!0}}}scheduler.matrix={};scheduler._merge=function(a,b){for(var c in b)"undefined"==typeof a[c]&&(a[c]=b[c])};scheduler.createTimelineView=function(a){scheduler._skin_init();scheduler._merge(a,{section_autoheight:!0,name:"matrix",x:"time",y:"time",x_step:1,x_unit:"hour",y_unit:"day",y_step:1,x_start:0,x_size:24,y_start:0,y_size:7,render:"cell",dx:200,dy:50,event_dy:scheduler.xy.bar_height-5,event_min_dy:scheduler.xy.bar_height-5,resize_events:!0,fit_events:!0,
show_unassigned:!1,second_scale:!1,round_position:!1,_logic:function(a,b,c){var d={};return scheduler.checkEvent("onBeforeSectionRender")&&(d=scheduler.callEvent("onBeforeSectionRender",[a,b,c])),d}});a._original_x_start=a.x_start;"day"!=a.x_unit&&(a.first_hour=a.last_hour=0);a._start_correction=a.first_hour?36E5*a.first_hour:0;a._end_correction=a.last_hour?36E5*(24-a.last_hour):0;scheduler.checkEvent("onTimelineCreated")&&scheduler.callEvent("onTimelineCreated",[a]);var c=scheduler.render_data;scheduler.render_data=
function(b,d){if(this._mode!=a.name)return c.apply(this,arguments);if(d&&!a.show_unassigned&&"cell"!=a.render)for(var e=0;e<b.length;e++)this.clear_event(b[e]),this.render_timeline_event.call(this.matrix[this._mode],b[e],!0);else scheduler._renderMatrix.call(a,!0,!0)};scheduler.matrix[a.name]=a;scheduler.templates[a.name+"_cell_value"]=function(a){return a?a.length:""};scheduler.templates[a.name+"_cell_class"]=function(){return""};scheduler.templates[a.name+"_scalex_class"]=function(){return""};scheduler.templates[a.name+
"_second_scalex_class"]=function(){return""};scheduler.templates[a.name+"_scaley_class"]=function(){return""};scheduler.templates[a.name+"_scale_label"]=function(a,b){return b};scheduler.templates[a.name+"_tooltip"]=function(a,b,c){return c.text};scheduler.templates[a.name+"_date"]=function(a,b){return a.getDay()==b.getDay()&&864E5>b-a||+a==+scheduler.date.date_part(new Date(b))||+scheduler.date.add(a,1,"day")==+b&&0===b.getHours()&&0===b.getMinutes()?scheduler.templates.day_date(a):a.getDay()!=b.getDay()&&
864E5>b-a?scheduler.templates.day_date(a)+" &ndash; "+scheduler.templates.day_date(b):scheduler.templates.week_date(a,b)};scheduler.templates[a.name+"_scale_date"]=scheduler.date.date_to_str(a.x_date||scheduler.config.hour_date);scheduler.templates[a.name+"_second_scale_date"]=scheduler.date.date_to_str(a.second_scale&&a.second_scale.x_date?a.second_scale.x_date:scheduler.config.hour_date);scheduler.date["add_"+a.name+"_private"]=function(b,c){var d=c,e=a.x_unit;if("minute"==a.x_unit||"hour"==a.x_unit){var f=
d;"hour"==a.x_unit&&(f*=60);f%1440||(d=f/1440,e="day")}return scheduler.date.add(b,d,e)};scheduler.date["add_"+a.name]=function(b,c){var d=scheduler.date["add_"+a.name+"_private"](b,(a.x_length||a.x_size)*a.x_step*c);if("minute"==a.x_unit||"hour"==a.x_unit){var e=a.x_length||a.x_size,f="hour"==a.x_unit?60*a.x_step:a.x_step;f*e%1440&&(+scheduler.date.date_part(new Date(b))==+scheduler.date.date_part(new Date(d))?a.x_start+=c*e:(e=Math.round((1440/(e*f)-1)*e),a.x_start=0<c?a.x_start-e:e+a.x_start))}return d};
scheduler.date[a.name+"_start"]=function(b){b=(scheduler.date[a.x_unit+"_start"]||scheduler.date.day_start).call(scheduler.date,b);return scheduler.date.add(b,a.x_step*a.x_start,a.x_unit)};scheduler.callEvent("onOptionsLoad",[a]);scheduler[a.name+"_view"]=function(b){b?scheduler._set_timeline_dates(a):scheduler._renderMatrix.apply(a,arguments)};var d=new Date;scheduler.date.add(d,a.x_step,a.x_unit).valueOf()-d.valueOf();scheduler["mouse_"+a.name]=function(c){var d=this._drag_event;this._drag_id&&
(d=this.getEvent(this._drag_id),this._drag_event._dhx_changed=!0);c.x-=a.dx;var e=scheduler._timeline_drag_date(a,c.x);if(c.x=0,c.force_redraw=!0,c.custom=!0,"move"==this._drag_mode&&this._drag_id&&this._drag_event){var d=this.getEvent(this._drag_id),f=this._drag_event;(c._ignores=this._ignores_detected||a._start_correction||a._end_correction,void 0===f._move_delta&&(f._move_delta=(d.start_date-e)/6E4,this.config.preserve_length&&c._ignores&&(f._move_delta=this._get_real_event_length(d.start_date,
e,a),f._event_length=this._get_real_event_length(d.start_date,d.end_date,a))),this.config.preserve_length&&c._ignores)?(f=(f._event_length,this._get_fictional_event_length(e,f._move_delta,a,!0)),e=new Date(e-f)):e=scheduler.date.add(e,f._move_delta,"minute")}if("resize"==this._drag_mode&&d&&(this._drag_from_start&&+e>+d.end_date?this._drag_from_start=!1:!this._drag_from_start&&+e<+d.start_date&&(this._drag_from_start=!0),c.resize_from_start=this._drag_from_start),a.round_position)switch(this._drag_mode){case "move":this.config.preserve_length||
(e=b.call(a,e,!1),"day"==a.x_unit&&(c.custom=!1));break;case "resize":this._drag_event&&((null===this._drag_event._resize_from_start||void 0===this._drag_event._resize_from_start)&&(this._drag_event._resize_from_start=c.resize_from_start),c.resize_from_start=this._drag_event._resize_from_start,e=b.call(a,e,!this._drag_event._resize_from_start))}return this._resolve_timeline_section(a,c),c.section&&this._update_timeline_section({pos:c,event:this.getEvent(this._drag_id),view:a}),c.y=Math.round((this._correct_shift(e,
1)-this._min_date)/(6E4*this.config.time_step)),c.shift=this.config.time_step,c}};scheduler._get_timeline_event_height=function(a,b){var c=a[b.y_property],d=b.event_dy;return"full"==b.event_dy&&(d=b.section_autoheight?b._section_height[c]-6:b.dy-3),b.resize_events&&(d=Math.max(Math.floor(d/a._count),b.event_min_dy)),d};scheduler._get_timeline_event_y=function(a,b){var c=2+a*b+(a?2*a:0);return scheduler.config.cascade_event_display&&(c=2+a*scheduler.config.cascade_event_margin+(a?2*a:0)),c};scheduler.render_timeline_event=
function(b,c){var d=b[this.y_property];if(!d)return"";var e=b._sorder,f=a(b,!1,this),g=a(b,!0,this),h=scheduler._get_timeline_event_height(b,this),k=h-2;b._inner||"full"!=this.event_dy||(k=(k+2)*(b._count-e)-2);e=scheduler._get_timeline_event_y(b._sorder,h);h=h+e+2;(!this._events_height[d]||this._events_height[d]<h)&&(this._events_height[d]=h);var l=scheduler.templates.event_class(b.start_date,b.end_date,b),l="dhx_cal_event_line "+(l||"");b._no_drag_move&&(l+=" no_drag_move");var m=b.color?"background:"+
b.color+";":"",n=b.textColor?"color:"+b.textColor+";":"",h=scheduler.templates.event_bar_text(b.start_date,b.end_date,b),f='<div event_id="'+b.id+'" class="'+l+'" style="'+m+n+"position:absolute; top:"+e+"px; height: "+k+"px; left:"+f+"px; width:"+Math.max(0,g-f)+"px;"+(b._text_style||"")+'">';scheduler.config.drag_resize&&!scheduler.config.readonly&&(f+=(b._no_resize_start?"":"<div class='dhx_event_resize dhx_event_resize_start' style='height: "+k+"px;'></div>")+(b._no_resize_end?"":"<div class='dhx_event_resize dhx_event_resize_end' style='height: "+
k+"px;'></div>"));if(f+=h+"</div>",!c)return f;k=document.createElement("DIV");k.innerHTML=f;d=scheduler._els.dhx_cal_data[0].firstChild.rows[this.order[d]].cells[1].firstChild;scheduler._rendered.push(k.firstChild);d.appendChild(k.firstChild)};scheduler._matrix_tooltip_handler=function(a){var b=scheduler.matrix[scheduler._mode];if(b&&"cell"==b.render){if(b){var c=scheduler._locate_cell_timeline(a);a=a||event;a.target||a.srcElement;if(c)return k(b,c,getOffset(c.src))}g()}};scheduler._init_matrix_tooltip=
function(){scheduler._detachDomEvent(scheduler._els.dhx_cal_data[0],"mouseover",scheduler._matrix_tooltip_handler);dhtmlxEvent(scheduler._els.dhx_cal_data[0],"mouseover",scheduler._matrix_tooltip_handler)};scheduler._set_timeline_dates=function(a){scheduler._min_date=scheduler.date[a.name+"_start"](scheduler._date);scheduler._max_date=scheduler.date["add_"+a.name+"_private"](scheduler._min_date,a.x_size*a.x_step);scheduler._table_view=!0};scheduler._renderMatrix=function(a,b){if(b||(scheduler._els.dhx_cal_data[0].scrollTop=
0),scheduler._set_timeline_dates(this),this.second_scale&&(a&&!this._header_resized&&(this._header_resized=scheduler.xy.scale_height,scheduler.xy.scale_height*=2,scheduler._els.dhx_cal_header[0].className+=" dhx_second_cal_header"),!a&&this._header_resized)){scheduler.xy.scale_height/=2;this._header_resized=!1;var d=scheduler._els.dhx_cal_header[0];d.className=d.className.replace(/ dhx_second_cal_header/gi,"")}if(a){scheduler.set_sizes();scheduler._init_matrix_tooltip();d=scheduler._min_date;e.call(this,
scheduler._els.dhx_cal_header[0]);var f=scheduler._els.dhx_cal_data[0],h="<table style='table-layout:fixed;' cellspacing='0' cellpadding='0'>",k=[];if(scheduler._load_mode&&scheduler._load(),"cell"==this.render){for(var k=scheduler.get_visible_events(),l=[],m=0;m<this.y_unit.length;m++)l[m]=[];l[n]||(l[n]=[]);for(m=0;m<k.length;m++){for(var n=this.order[k[m][this.y_property]],r=0;this._trace_x[r+1]&&k[m].start_date>=this._trace_x[r+1];)r++;for(;this._trace_x[r]&&k[m].end_date>this._trace_x[r];)l[n][r]||
(l[n][r]=[]),l[n][r].push(k[m]),r++}k=l}else for(n=scheduler.get_visible_events(),m=this.order,r=0;r<n.length;r++){var w=n[r],p=w[this.y_property],t=this.order[p];if(this.show_unassigned&&!p)for(l in m)m.hasOwnProperty(l)&&(t=m[l],k[t]||(k[t]=[]),p=scheduler._lame_copy({},w),p[this.y_property]=l,k[t].push(p));else k[t]||(k[t]=[]),k[t].push(w)}for(l=w=0;l<scheduler._cols.length;l++)w+=scheduler._cols[l];l=new Date;n=scheduler._cols.length-scheduler._ignores_detected;this._step=l=(scheduler.date.add(l,
this.x_step*n,this.x_unit)-l-(this._start_correction+this._end_correction)*n)/w;this._summ=w;n=scheduler._colsS.heights=[];m=[];this._events_height={};this._section_height={};for(l=0;l<this.y_unit.length;l++){t=this._logic(this.render,this.y_unit[l],this);scheduler._merge(t,{height:this.dy});this.section_autoheight&&(this.y_unit.length*t.height<f.offsetHeight&&(t.height=Math.max(t.height,Math.floor((f.offsetHeight-1)/this.y_unit.length))),this._section_height[this.y_unit[l].key]=t.height);t.td_className||
(t.td_className="dhx_matrix_scell"+(scheduler.templates[this.name+"_scaley_class"](this.y_unit[l].key,this.y_unit[l].label,this.y_unit[l])?" "+scheduler.templates[this.name+"_scaley_class"](this.y_unit[l].key,this.y_unit[l].label,this.y_unit[l]):""));t.td_content||(t.td_content=scheduler.templates[this.name+"_scale_label"](this.y_unit[l].key,this.y_unit[l].label,this.y_unit[l]));scheduler._merge(t,{tr_className:"",style_height:"height:"+t.height+"px;",style_width:"width:"+(this.dx-1)+"px;",summ_width:"width:"+
w+"px;",table_className:""});r=c.call(this,k[l]);this.fit_events&&(p=this._events_height[this.y_unit[l].key]||0,t.height=p>t.height?p:t.height,t.style_height="height:"+t.height+"px;",this._section_height[this.y_unit[l].key]=t.height);if(h+="<tr class='"+t.tr_className+"' style='"+t.style_height+"'><td class='"+t.td_className+"' style='"+t.style_width+" height:"+(t.height-1)+"px;'>"+t.td_content+"</td>","cell"==this.render)for(r=0;r<scheduler._cols.length;r++)h+=scheduler._ignores[r]?"<td></td>":"<td class='dhx_matrix_cell "+
scheduler.templates[this.name+"_cell_class"](k[l][r],this._trace_x[r],this.y_unit[l])+"' style='width:"+(scheduler._cols[r]-1)+"px'><div style='width:"+(scheduler._cols[r]-1)+"px'>"+scheduler.templates[this.name+"_cell_value"](k[l][r],this._trace_x[r],this.y_unit[l])+"</div></td>";else{h+="<td><div style='"+t.summ_width+" "+t.style_height+" position:relative;' class='dhx_matrix_line'>";h+=r;h+="<table class='"+t.table_className+"' cellpadding='0' cellspacing='0' style='"+t.summ_width+" "+t.style_height+
"' >";for(r=0;r<scheduler._cols.length;r++)h+=scheduler._ignores[r]?"<td></td>":"<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](k[l],this._trace_x[r],this.y_unit[l])+"' style='width:"+(scheduler._cols[r]-1)+"px'><div style='width:"+(scheduler._cols[r]-1)+"px'></div></td>";h+="</table>";h+="</div></td>"}h+="</tr>";m.push(t)}this._matrix=k;f.innerHTML=h+"</table>";scheduler._rendered=[];h=scheduler._obj.getElementsByTagName("DIV");for(l=0;l<h.length;l++)h[l].getAttribute("event_id")&&
scheduler._rendered.push(h[l]);this._scales={};f=f.firstChild.rows;k=null;l=0;for(h=m.length;h>l;l++)k=this.y_unit[l],n.push(m[l].height),k=k.key,r=this._scales[k]=scheduler._isRender("cell")?f[l]:f[l].childNodes[1].getElementsByTagName("div")[0],scheduler.callEvent("onScaleAdd",[r,k]);scheduler._min_date=d;scheduler._els.dhx_cal_date[0].innerHTML=scheduler.templates[this.name+"_date"](scheduler._min_date,scheduler._max_date);scheduler._mark_now&&scheduler._mark_now()}g()};scheduler._locate_cell_timeline=
function(a){a=a||event;var b=a.target?a.target:a.srcElement,c={},d=scheduler.matrix[scheduler._mode];a=scheduler.getActionData(a);for(var e=0;e<d._trace_x.length-1&&!(+a.date<d._trace_x[e+1]);e++);c.x=e;c.y=d.order[a.section];var f=scheduler._isRender("cell")?1:0;c.src=d._scales[a.section]?d._scales[a.section].getElementsByTagName("td")[e+f]:null;for(d=!1;0===c.x&&"dhx_cal_data"!=b.className&&b.parentNode;){if("dhx_matrix_scell"==b.className.split(" ")[0]){d=!0;break}b=b.parentNode}return d&&(c.x=
-1,c.src=b,c.scale=!0),c};var h=scheduler._click.dhx_cal_data;scheduler._click.dhx_marked_timespan=scheduler._click.dhx_cal_data=function(a){var b=h.apply(this,arguments),c=scheduler.matrix[scheduler._mode];if(c){var d=scheduler._locate_cell_timeline(a);d&&(d.scale?scheduler.callEvent("onYScaleClick",[d.y,c.y_unit[d.y],a||event]):scheduler.callEvent("onCellClick",[d.x,d.y,c._trace_x[d.x],(c._matrix[d.y]||{})[d.x]||[],a||event]))}return b};scheduler.dblclick_dhx_matrix_cell=function(a){var b=scheduler.matrix[scheduler._mode];
if(b){var c=scheduler._locate_cell_timeline(a);c&&(c.scale?scheduler.callEvent("onYScaleDblClick",[c.y,b.y_unit[c.y],a||event]):scheduler.callEvent("onCellDblClick",[c.x,c.y,b._trace_x[c.x],(b._matrix[c.y]||{})[c.x]||[],a||event]))}};var m=scheduler.dblclick_dhx_marked_timespan||function(){};scheduler.dblclick_dhx_marked_timespan=function(a){return scheduler.matrix[scheduler._mode]?scheduler.dblclick_dhx_matrix_cell(a):m.apply(this,arguments)};scheduler.dblclick_dhx_matrix_scell=function(a){return scheduler.dblclick_dhx_matrix_cell(a)};
scheduler._isRender=function(a){return scheduler.matrix[scheduler._mode]&&scheduler.matrix[scheduler._mode].render==a};scheduler.attachEvent("onCellDblClick",function(a,b,c,d,e){this.config.readonly||"dblclick"==e.type&&!this.config.dblclick_create||(c=scheduler.matrix[scheduler._mode],d={},d.start_date=c._trace_x[a],d.end_date=c._trace_x[a+1]?c._trace_x[a+1]:scheduler.date.add(c._trace_x[a],c.x_step,c.x_unit),c._start_correction&&(d.start_date=new Date(1*d.start_date+c._start_correction)),c._end_correction&&
(d.end_date=new Date(d.end_date-c._end_correction)),d[c.y_property]=c.y_unit[b].key,scheduler.addEventNow(d,null,e))});scheduler.attachEvent("onBeforeDrag",function(){return!scheduler._isRender("cell")});scheduler.attachEvent("onEventChanged",function(a,b){b._timed=this.isOneDayEvent(b)});scheduler.attachEvent("onBeforeEventChanged",function(a){return scheduler._events[a.id]&&(a._move_delta=void 0),!0});scheduler._is_column_visible=function(a){a=scheduler._get_date_index(scheduler.matrix[scheduler._mode],
a);return!scheduler._ignores[a]};var p=scheduler._render_marked_timespan;scheduler._render_marked_timespan=function(b,c,d,e,f){if(!scheduler.config.display_marked_timespans)return[];if(scheduler.matrix&&scheduler.matrix[scheduler._mode]){if(scheduler._isRender("cell"))return;var g=scheduler._lame_copy({},scheduler.matrix[scheduler._mode]);g.round_position=!1;var h=[],k=[],l=[],m=b.sections?b.sections.units||b.sections.timeline:null;if(d)l=[c],k=[d];else if(c=g.order,m)c.hasOwnProperty(m)&&(k.push(m),
l.push(g._scales[m]));else for(var n in c)c.hasOwnProperty(n)&&(k.push(n),l.push(g._scales[n]));e=e?new Date(e):scheduler._min_date;f=f?new Date(f):scheduler._max_date;e.valueOf()<scheduler._min_date.valueOf()&&(e=new Date(scheduler._min_date));f.valueOf()>scheduler._max_date.valueOf()&&(f=new Date(scheduler._max_date));for(n=0;n<g._trace_x.length&&!scheduler._is_column_visible(g._trace_x[n]);n++);if(n==g._trace_x.length)return;m=[];6<b.days?(c=new Date(b.days),scheduler.date.date_part(new Date(e))<=
+c&&+f>=+c&&m.push(c)):m.push.apply(m,scheduler._get_dates_by_index(b.days));for(var H=b.zones,t=scheduler._get_css_classes_by_config(b),F=0;F<k.length;F++)for(c=l[F],d=k[F],n=0;n<m.length;n++)for(var I=m[n],D=0;D<H.length;D+=2){var E=new Date(+I+6E4*H[D]),A=new Date(+I+6E4*H[D+1]);if(A>e&&f>E){var G=scheduler._get_block_by_config(b);G.className=t;E=a({start_date:E},!1,g)-1;A=a({start_date:A},!1,g)-1;A=Math.max(1,A-E-1);G.style.cssText="height: "+(g._section_height[d]-1)+"px; left: "+E+"px; width: "+
A+"px; top: 0;";c.insertBefore(G,c.firstChild);h.push(G)}}return h}return p.apply(scheduler,[b,c,d])};var n=scheduler._append_mark_now;scheduler._append_mark_now=function(a,b){if(scheduler.matrix&&scheduler.matrix[scheduler._mode]){var c=scheduler._currentDate(),d=scheduler._get_zone_minutes(c),c={days:+scheduler.date.date_part(c),zones:[d,d+1],css:"dhx_matrix_now_time",type:"dhx_now_time"};return scheduler._render_marked_timespan(c)}return n.apply(scheduler,[a,b])};scheduler.attachEvent("onScaleAdd",
function(a,b){var c=scheduler._marked_timespans;if(c&&scheduler.matrix&&scheduler.matrix[scheduler._mode])for(var d=scheduler._mode,e=scheduler._max_date,f=c.global,g=scheduler.date.date_part(new Date(scheduler._min_date));e>g;g=scheduler.date.add(g,1,"day")){var h=+g,k=g.getDay(),l=[];if(l.push.apply(l,scheduler._get_configs_to_render(f[h]||f[k])),c[d]&&c[d][b]){var m=[],h=scheduler._get_types_to_render(c[d][b][k],c[d][b][h]);m.push.apply(m,scheduler._get_configs_to_render(h));m.length&&(l=m)}for(m=
0;m<l.length;m++)scheduler._render_marked_timespan(l[m],a,b,g,scheduler.date.add(g,1,"day"))}});scheduler._resolve_timeline_section=function(a,b){var c=0,d=0;for(c;c<this._colsS.heights.length&&(d+=this._colsS.heights[c],!(d>b.y));c++);a.y_unit[c]||(c=a.y_unit.length-1);this._drag_event&&!this._drag_event._orig_section&&(this._drag_event._orig_section=a.y_unit[c].key);b.fields={};0<=c&&a.y_unit[c]&&(b.section=b.fields[a.y_property]=a.y_unit[c].key)};scheduler._update_timeline_section=function(a){var b=
a.view,c=a.event;a=a.pos;if(c){if(c[b.y_property]!=a.section){var d=this._get_timeline_event_height(c,b);c._sorder=this._get_dnd_order(c._sorder,d,b._section_height[a.section])}c[b.y_property]=a.section}};scheduler._get_date_index=function(a,b){for(var c=0,d=a._trace_x;c<d.length-1&&+b>=+d[c+1];)c++;return c};scheduler._timeline_drag_date=function(a,b){var c,d,e=0,f=0;for(f;f<=this._cols.length-1;f++)if(d=this._cols[f],e+=d,e>b){c=(b-(e-d))/d;c=0>c?0:c;break}a.round_position&&(e=1,scheduler.getState().drag_mode&&
"move"!=scheduler.getState().drag_mode&&(e=.5),c>=e&&f++,c=0);if(0===f&&this._ignores[0])for(f=1,c=0;this._ignores[f];)f++;else if(f==this._cols.length&&this._ignores[f-1]){f=this._cols.length-1;for(c=0;this._ignores[f];)f--;f++}f>=a._trace_x.length?(c=scheduler.date.add(a._trace_x[a._trace_x.length-1],a.x_step,a.x_unit),a._end_correction&&(c=new Date(c-a._end_correction))):c=new Date(+a._trace_x[f]+(c*d*a._step+a._start_correction));return c};scheduler.attachEvent("onBeforeTodayDisplayed",function(){for(var a in scheduler.matrix){var b=
scheduler.matrix[a];b.x_start=b._original_x_start}return!0});scheduler.attachEvent("onOptionsLoad",function(){for(var a in scheduler.matrix){var b=scheduler.matrix[a];b.order={};scheduler.callEvent("onOptionsLoadStart",[]);for(a=0;a<b.y_unit.length;a++)b.order[b.y_unit[a].key]=a;scheduler.callEvent("onOptionsLoadFinal",[]);scheduler._date&&b.name==scheduler._mode&&scheduler.setCurrentView(scheduler._date,scheduler._mode)}});scheduler.attachEvent("onSchedulerResize",function(){return scheduler.matrix[this._mode]?
(scheduler._renderMatrix.call(scheduler.matrix[this._mode],!0,!0),!1):!0});scheduler.attachEvent("onBeforeDrag",function(a,b,c){"resize"==b&&(scheduler._drag_from_start=0>((c.target||c.srcElement).className||"").indexOf("dhx_event_resize_end")?!0:!1);return!0})};scheduler._temp_matrix_scope();scheduler.attachEvent("onTimelineCreated",function(a){"tree"==a.render&&(a.y_unit_original=a.y_unit,a.y_unit=scheduler._getArrayToDisplay(a.y_unit_original),scheduler.attachEvent("onOptionsLoadStart",function(){a.y_unit=scheduler._getArrayToDisplay(a.y_unit_original)}),scheduler.form_blocks[a.name]={render:function(a){return"<div class='dhx_section_timeline' style='overflow: hidden; height: "+a.height+"px'></div>"},set_value:function(a,c,d,e){c=scheduler._getArrayForSelect(scheduler.matrix[e.type].y_unit_original,
e.type);a.innerHTML="";var f=document.createElement("select");a.appendChild(f);a=a.getElementsByTagName("select")[0];!a._dhx_onchange&&e.onchange&&(a.onchange=e.onchange,a._dhx_onchange=!0);for(f=0;f<c.length;f++){var g=document.createElement("option");g.value=c[f].key;g.value==d[scheduler.matrix[e.type].y_property]&&(g.selected=!0);g.innerHTML=c[f].label;a.appendChild(g)}},get_value:function(a){return a.firstChild.value},focus:function(){}})});
scheduler.attachEvent("onBeforeSectionRender",function(a,b,c){var d={};if("tree"==a){var e,f,g,k,l,h;b.children?(e=c.folder_dy||c.dy,c.folder_dy&&!c.section_autoheight&&(g="height:"+c.folder_dy+"px;"),f="dhx_row_folder",k="dhx_matrix_scell folder",l="<div class='dhx_scell_expand'>"+(b.open?"-":"+")+"</div>",h=c.folder_events_available?"dhx_data_table folder_events":"dhx_data_table folder"):(e=c.dy,f="dhx_row_item",k="dhx_matrix_scell item"+(scheduler.templates[c.name+"_scaley_class"](b.key,b.label,
b)?" "+scheduler.templates[c.name+"_scaley_class"](b.key,b.label,b):""),l="",h="dhx_data_table");a="<div class='dhx_scell_level"+b.level+"'>"+l+"<div class='dhx_scell_name'>"+(scheduler.templates[c.name+"_scale_label"](b.key,b.label,b)||b.label)+"</div></div>";d={height:e,style_height:g,tr_className:f,td_className:k,td_content:a,table_className:h}}return d});var section_id_before;
scheduler.attachEvent("onBeforeEventChanged",function(a,b,c){if(scheduler._isRender("tree")){b=scheduler._get_event_sections?scheduler._get_event_sections(a):[a[scheduler.matrix[scheduler._mode].y_property]];for(var d=0;d<b.length;d++){var e=scheduler.getSection(b[d]);if(e&&"undefined"!=typeof e.children&&!scheduler.matrix[scheduler._mode].folder_events_available)return c||(a[scheduler.matrix[scheduler._mode].y_property]=section_id_before),!1}}return!0});
scheduler.attachEvent("onBeforeDrag",function(a,b,c){if(scheduler._isRender("tree")){var d;if((b=scheduler._locate_cell_timeline(c))&&(d=scheduler.matrix[scheduler._mode].y_unit[b.y].key,"undefined"!=typeof scheduler.matrix[scheduler._mode].y_unit[b.y].children&&!scheduler.matrix[scheduler._mode].folder_events_available))return!1;a=scheduler.getEvent(a);b=scheduler.matrix[scheduler._mode].y_property;section_id_before=a&&a[b]?a[b]:d}return!0});
scheduler._getArrayToDisplay=function(a){var b=[],c=function(a,e){for(var f=e||0,g=0;g<a.length;g++)a[g].level=f,"undefined"!=typeof a[g].children&&"undefined"==typeof a[g].key&&(a[g].key=scheduler.uid()),b.push(a[g]),a[g].open&&a[g].children&&c(a[g].children,f+1)};return c(a),b};
scheduler._getArrayForSelect=function(a,b){var c=[],d=function(a){for(var f=0;f<a.length;f++)scheduler.matrix[b].folder_events_available?c.push(a[f]):"undefined"==typeof a[f].children&&c.push(a[f]),a[f].children&&d(a[f].children,b)};return d(a),c};
scheduler._toggleFolderDisplay=function(a,b,c){var d=function(a,b,c,e){for(var h=0;h<b.length&&(b[h].key!=a&&!e||!b[h].children||(b[h].open="undefined"!=typeof c?c:!b[h].open,e||!1));h++)b[h].children&&d(a,b[h].children,c,e)},e=scheduler.getSection(a);"undefined"!=typeof b||c||(b=!e.open);scheduler.callEvent("onBeforeFolderToggle",[e,b,c])&&(d(a,scheduler.matrix[scheduler._mode].y_unit_original,b,c),scheduler.matrix[scheduler._mode].y_unit=scheduler._getArrayToDisplay(scheduler.matrix[scheduler._mode].y_unit_original),
scheduler.callEvent("onOptionsLoad",[]),scheduler.callEvent("onAfterFolderToggle",[e,b,c]))};scheduler.attachEvent("onCellClick",function(a,b){scheduler._isRender("tree")&&(scheduler.matrix[scheduler._mode].folder_events_available||"undefined"!=typeof scheduler.matrix[scheduler._mode].y_unit[b]&&"undefined"!=typeof scheduler.matrix[scheduler._mode].y_unit[b].children&&scheduler._toggleFolderDisplay(scheduler.matrix[scheduler._mode].y_unit[b].key))});
scheduler.attachEvent("onYScaleClick",function(a,b){scheduler._isRender("tree")&&"undefined"!=typeof b.children&&scheduler._toggleFolderDisplay(b.key)});scheduler.getSection=function(a){if(scheduler._isRender("tree")){var b,c=function(a,e){for(var f=0;f<e.length;f++)e[f].key==a&&(b=e[f]),e[f].children&&c(a,e[f].children)};return c(a,scheduler.matrix[scheduler._mode].y_unit_original),b||null}};
scheduler.deleteSection=function(a){if(scheduler._isRender("tree")){var b=!1,c=function(a,e){for(var f=0;f<e.length&&(e[f].key==a&&(e.splice(f,1),b=!0),!b);f++)e[f].children&&c(a,e[f].children)};return c(a,scheduler.matrix[scheduler._mode].y_unit_original),scheduler.matrix[scheduler._mode].y_unit=scheduler._getArrayToDisplay(scheduler.matrix[scheduler._mode].y_unit_original),scheduler.callEvent("onOptionsLoad",[]),b}};
scheduler.deleteAllSections=function(){scheduler._isRender("tree")&&(scheduler.matrix[scheduler._mode].y_unit_original=[],scheduler.matrix[scheduler._mode].y_unit=scheduler._getArrayToDisplay(scheduler.matrix[scheduler._mode].y_unit_original),scheduler.callEvent("onOptionsLoad",[]))};
scheduler.addSection=function(a,b){if(scheduler._isRender("tree")){var c=!1,d=function(a,f,g){if(b)for(var k=0;k<g.length&&(g[k].key==f&&"undefined"!=typeof g[k].children&&(g[k].children.push(a),c=!0),!c);k++)g[k].children&&d(a,f,g[k].children);else g.push(a),c=!0};return d(a,b,scheduler.matrix[scheduler._mode].y_unit_original),scheduler.matrix[scheduler._mode].y_unit=scheduler._getArrayToDisplay(scheduler.matrix[scheduler._mode].y_unit_original),scheduler.callEvent("onOptionsLoad",[]),c}};
scheduler.openAllSections=function(){scheduler._isRender("tree")&&scheduler._toggleFolderDisplay(1,!0,!0)};scheduler.closeAllSections=function(){scheduler._isRender("tree")&&scheduler._toggleFolderDisplay(1,!1,!0)};scheduler.openSection=function(a){scheduler._isRender("tree")&&scheduler._toggleFolderDisplay(a,!0)};scheduler.closeSection=function(a){scheduler._isRender("tree")&&scheduler._toggleFolderDisplay(a,!1)};
